---
title: å…¥é—¨
date: 2022-01-16 16:41:40
permalink: /pages/6f1f8f/
categories:
  - Node
  - Webpack5
tags:
  -
---

# å…¥é—¨

## ä»‹ç»

æœ¬è´¨ä¸Šï¼Œ**webpack** æ˜¯ä¸€ä¸ªç”¨äºç°ä»£ JavaScript åº”ç”¨ç¨‹åºçš„ ***é™æ€æ¨¡å—æ‰“åŒ…å·¥å…·***ã€‚å½“ webpack å¤„ç†åº”ç”¨ç¨‹åºæ—¶ï¼Œå®ƒä¼šåœ¨å†…éƒ¨ä»ä¸€ä¸ªæˆ–å¤šä¸ªå…¥å£ç‚¹æ„å»ºä¸€ä¸ª [ä¾èµ–å›¾(dependency graph)](https://webpack.docschina.org/concepts/dependency-graph/)ï¼Œç„¶åå°†ä½ é¡¹ç›®ä¸­æ‰€éœ€çš„æ¯ä¸€ä¸ªæ¨¡å—ç»„åˆæˆä¸€ä¸ªæˆ–å¤šä¸ª *bundles*ï¼Œå®ƒä»¬å‡ä¸ºé™æ€èµ„æºï¼Œç”¨äºå±•ç¤ºä½ çš„å†…å®¹ã€‚

*   ç°ä»£çš„modernï¼šæˆ‘ä»¬å‰ç«¯è¯´è¿‡ï¼Œæ­£æ˜¯å› ä¸ºç°ä»£å‰ç«¯å¼€å‘é¢ä¸´å„ç§å„æ ·çš„é—®é¢˜ï¼Œæ‰å‚¬ç”Ÿäº†webpackçš„å‡ºç°å’Œå‘å±•
*   é™æ€çš„staticï¼šè¿™æ ·è¡¨è¿°çš„åŸå› æ˜¯æˆ‘ä»¬æœ€ç»ˆå¯ä»¥å°†ä»£ç æ‰“åŒ…æˆæœ€ç»ˆçš„é™æ€èµ„æº(éƒ¨ç½²åˆ°é™æ€æœåŠ¡å™¨)
*   æ¨¡å—åŒ–moduleï¼šwebpacké»˜è®¤æ”¯æŒå„ç§æ¨¡å—åŒ–å¼€å‘ï¼ŒES Moduleã€CommonJSã€AMDç­‰
*   æ‰“åŒ…bundlerï¼šwebpackå¯ä»¥å°†å¸®åŠ©æˆ‘ä»¬è¿›è¡Œæ‰“åŒ…ï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸€ä¸ªæ‰“åŒ…å·¥å…·





## æ‰“åŒ…çš„ä¸œè¥¿

**JavaScriptçš„æ‰“åŒ…**:

*   ES6è½¬æ¢æˆES5çš„è¯­æ³•;
*   TypeScriptçš„å¤„ç†ï¼Œå°†å…¶è½¬æ¢æˆJavaScript;

**Cssçš„å¤„ç†**:

*   CSSæ–‡ä»¶æ¨¡å—çš„åŠ è½½ã€æå–;
*   Lessã€Sassç­‰é¢„å¤„ç†å™¨çš„å¤„ç†;

**èµ„æºæ–‡ä»¶imgã€font**:

*   å›¾ç‰‡imgæ–‡ä»¶çš„åŠ è½½; 
*   å­—ä½“fontæ–‡ä»¶çš„åŠ è½½;

**HTMLèµ„æºçš„å¤„ç†**

*   æ‰“åŒ…HTMLèµ„æºæ–‡ä»¶;

**å¤„ç†vueé¡¹ç›®çš„SFCæ–‡ä»¶.vueæ–‡ä»¶;**





## Node å’Œ NPM ç‰ˆæœ¬

ç›®å‰ä½¿ç”¨çš„ç‰ˆæœ¬

```bash
v14.18.3
6.14.15
```





## webpack & webpack-cli

webpackçš„å®‰è£…ç›®å‰åˆ†ä¸ºä¸¤ä¸ªï¼šwebpackã€webpack-cli

Â·é‚£ä¹ˆå®ƒä»¬æ˜¯ä»€ä¹ˆå…³ç³»å‘¢?

*   æ‰§è¡Œwebpackå‘½ä»¤ï¼Œä¼šæ‰§è¡Œnode_modulesä¸‹çš„.binç›®å½•ä¸‹çš„webpack;
*   webpackåœ¨æ‰§è¡Œæ—¶æ˜¯ä¾èµ–webpack-cliçš„ï¼Œå¦‚æœæ²¡æœ‰å®‰è£…å°±ä¼šæŠ¥é”™;
*   è€Œwebpack-cliä¸­ä»£ç æ‰§è¡Œæ—¶ï¼Œæ‰æ˜¯çœŸæ­£åˆ©ç”¨webpackè¿›è¡Œç¼–è¯‘å’Œæ‰“åŒ…çš„è¿‡ç¨‹;
*   æ‰€ä»¥åœ¨å®‰è£…webpackæ—¶ï¼Œæˆ‘ä»¬éœ€è¦åŒæ—¶å®‰è£…webpack-cli(ç¬¬ä¸‰æ–¹çš„è„šæ‰‹æ¶äº‹å®ä¸Šæ˜¯æ²¡æœ‰ä½¿ç”¨webpack-cliçš„ï¼Œè€Œæ˜¯ç±»ä¼¼äºè‡ªå·±çš„vue-service-cliçš„ä¸œè¥¿)

![image-20220116170535399](./images/image-20220116170535399.png)







## å…¨å±€ webpack æ‰“åŒ…

å®‰è£…

```bash
npm install webpack webpack-cli â€“g # å…¨å±€å®‰è£… 
```



åˆ›å»ºå¦‚ä¸‹æ–‡ä»¶

![image-20220116172022406](./images/image-20220116172022406.png)

/index.html

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <!-- æºjsæ–‡ä»¶æ— æ³•è¿è¡Œ -->
    <script src="./src/index.js" type="module"></script>
  </body>
</html>
```

/src/index.js

```js
import { sum } from "./js/math";
const { priceFormat } = require("./js/format");

console.log(sum(20, 30));
console.log(priceFormat());
```

/src/js/format.js

```js
const priceFormat = function() {
  return "Â¥99.88";
}

// CommonJSçš„å¯¼å‡º
module.exports = {
  priceFormat
}
```

/src/js/math.js

```js
// ES Module
export function sum(num1, num2) {
  return num1 + num2;
}
```

åœ¨é¡¹ç›®`/`ç›®å½•ä¸‹æ‰§è¡Œ`webpack`ï¼Œä¼šç”Ÿæˆ`/dist/main.js`ï¼Œå°†htmlæ›¿æ¢ä¸º

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <!-- æºjsæ–‡ä»¶æ— æ³•è¿è¡Œ -->
    <!-- <script src="./src/index.js" type="module"></script> -->
    <!-- æ‰“åŒ…åçš„jsæ–‡ä»¶å¯ä»¥è®¿é—® -->
    <script src="./dist/main.js"></script>
  </body>
</html>
```

å°±ä¼šè¿è¡ŒæˆåŠŸï¼







## å±€éƒ¨ webpack æ‰“åŒ… ğŸ”¥

```bash
npm init
npm install webpack webpack-cli -D
npx webpack
```

`npx`æ„æ€æ˜¯åœ¨`npm`å®‰è£…çš„`node_modules`ä¸­çš„`.bin`ç›®å½•ä¸‹æŸ¥æ‰¾å‘½ä»¤

åœ¨package.jsonä¸­åˆ›å»ºscriptsè„šæœ¬ï¼Œæ‰§è¡Œè„šæœ¬æ‰“åŒ…å³å¯

```json
  "scripts": {
    "build": "webpack"
  },
```

æ­¤æ—¶åªå†™webpackï¼Œå®ƒä¼šè‡ªåŠ¨å…ˆåœ¨`node_modules`ä¸­çš„`.bin`ç›®å½•ä¸‹æŸ¥æ‰¾å‘½ä»¤ã€‚æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å³å¯æ‰“åŒ…

```
npm run build
```







## å…¥å£ã€å‡ºå£æ–‡ä»¶é…ç½® ğŸ”¥

å½“æˆ‘ä»¬è¿è¡Œ`webpack`æ—¶ï¼Œwebpackä¼šæŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹çš„ `src/index.js`ä½œä¸ºå…¥å£ï¼Œä¸å­˜åœ¨åˆ™æŠ¥é”™

**å¯ä»¥é€šè¿‡é…ç½®æ¥æŒ‡å®šå…¥å£å’Œå‡ºå£**ï¼š

```bash
 npx webpack --entry ./src/main.js --output-path ./build
```

ä½†æ˜¯ä¸æ¨èè¯¥æ–¹å¼ï¼Œå¯ä»¥åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º`wepack.config.js`æ–‡ä»¶

```js
const path = require('path')

// Webpackåœ¨Nodeç¯å¢ƒè¿è¡Œï¼ŒNodeä½¿ç”¨çš„CommonJSï¼Œè¦æ”¹ä¸ºES6éœ€è¦é…ç½®ï¼Œæ¯”è¾ƒéº»çƒ¦
module.exports = {
  // å…¥å£æ–‡ä»¶å
  entry: './src/main.js',
  output: {
    // pathå¿…é¡»æ˜¯ç»å¯¹è·¯å¾„ï¼ï¼ï¼ï¼Œ__dirnameä»£è¡¨å½“å‰æ–‡ä»¶ï¼ˆwebpack.config.jsï¼‰æ‰€åœ¨ç»å¯¹è·¯å¾„
    path: path.resolve(__dirname, './build'),
    filename: 'bundle.js',
  },
}
```

åœ¨package.jsonä¸­ä¿®æ”¹scriptsè„šæœ¬å³å¯ä½¿ç”¨

```json
"build": "webpack"
```

è‹¥æ˜¯åˆ›å»ºçš„æ–‡ä»¶åä¸æ˜¯é»˜è®¤çš„ï¼Œè€Œæ˜¯å¦‚`  conana.config.js`ï¼Œåˆ™éœ€è¦ä¿®æ”¹scriptsè„šæœ¬ã€‚ä¸æ¨èï¼ï¼ï¼

```json
"build": "webpack --config conana.config.js"
```







## Webpackçš„ä¾èµ–å›¾

![image-20200614121215477](./images/image-20200614121215477.png)

*   äº‹å®ä¸Šwebpackåœ¨å¤„ç†åº”ç”¨ç¨‹åºæ—¶ï¼Œå®ƒä¼šæ ¹æ®å‘½ä»¤æˆ–è€…é…ç½®æ–‡ä»¶æ‰¾åˆ°å…¥å£æ–‡ä»¶
*   ä»å…¥å£å¼€å§‹ï¼Œä¼šç”Ÿæˆä¸€ä¸ªä¾èµ–å…³ç³»å›¾ï¼Œè¿™ä¸ªä¾èµ–å…³ç³»å›¾ä¼šåŒ…å«åº”ç”¨ç¨‹åºä¸­æ‰€éœ€çš„æ‰€æœ‰æ¨¡å—(æ¯”å¦‚.jsæ–‡ä»¶ã€cssæ–‡ä»¶ã€å›¾ç‰‡ã€å­— ä½“ç­‰)
*   ç„¶åéå†å›¾ç»“æ„ï¼Œæ‰“åŒ…ä¸€ä¸ªä¸ªæ¨¡å—(æ ¹æ®æ–‡ä»¶çš„ä¸åŒä½¿ç”¨ä¸åŒçš„loaderæ¥è§£æ)
*   æ³¨æ„ï¼Œ**æ²¡æœ‰ä¾èµ–åˆ°çš„ä¸ä¼šæ‰“åŒ…**ï¼ï¼ï¼









## æ‰“åŒ… css

`css-loader` æ˜¯å°† css è§£æã€è£…è½½ï¼›`style-loader` æ˜¯å°†è§£æã€è£…è½½çš„ css æ·»åŠ åˆ° style æ ‡ç­¾ä¸­ã€‚

```bash
npm install css-loader style-loader -D
```

é…ç½®webpack.config.js

```js
module.exports = {\
  module: {
    rules: [
      {
        test: /\.css$/,
        // loader: 'css-loader',
        // use: ['css-loader'],
        // å®Œæ•´å†™æ³•(å€’åºæ‰§è¡Œï¼ï¼ï¼)
        use: [
          { loader: 'style-loader', options: {} },
          { loader: 'css-loader', options: {} },
        ],
      },
    ],
  },
}
```





## æ‰“åŒ… lessã€scssã€stylus

è¿™é‡Œä»¥ less ä¸ºä¾‹ã€‚`less`ä¼šå°†lessæ–‡ä»¶è½¬æ¢ä¸ºcssæ–‡ä»¶ï¼Œå®‰è£…åä¼šæœ‰ä¸ª`lessc`å¯æ‰§è¡Œæ–‡ä»¶ï¼›`less-loader`ä¼šæ‰¹é‡å°†lessæ–‡ä»¶è½¬ä¸ºcssæ–‡ä»¶

```
npm install less less-loader -D
```

é…ç½®webpack.config.js

```js
gmodule.exports = {
  module: {
    rules: [
      {
        test: /\.less$/,
        use: [
          { loader: 'style-loader', options: {} },
          { loader: 'css-loader', options: {} },
          { loader: 'less-loader', options: {} },
        ],
      },
    ],
  },
}
```





## PostCSS

CSSçš„è½¬æ¢å’Œé€‚é…ï¼Œæ¯”å¦‚è‡ªåŠ¨æ·»åŠ æµè§ˆå™¨å‰ç¼€ã€cssæ ·å¼çš„é‡ç½®ã€‚å®ç°è¿™äº›åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦å€ŸåŠ©äºPostCSSå¯¹åº”çš„æ’ä»¶

å¦‚ä½•ä½¿ç”¨PostCSSå‘¢?ä¸»è¦å°±æ˜¯ä¸¤ä¸ªæ­¥éª¤:

*   ç¬¬ä¸€æ­¥:æŸ¥æ‰¾PostCSSåœ¨æ„å»ºå·¥å…·ä¸­çš„æ‰©å±•ï¼Œæ¯”å¦‚webpackä¸­çš„postcss-loader; 
*   ç¬¬äºŒæ­¥:é€‰æ‹©å¯ä»¥æ·»åŠ ä½ éœ€è¦çš„PostCSSç›¸å…³çš„æ’ä»¶;



### å®‰è£… postcssã€postcss-cli

```bash
npm install postcss postcss-cli -D
```

postcss-cliå¯ä»¥ç›´æ¥åœ¨ç»ˆç«¯ä½¿ç”¨PostCSS

æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªéœ€è¦æ·»åŠ å‰ç¼€çš„csshttps://autoprefixer.github.io/ï¼Œåœ¨è¯¥ç½‘ç«™ä¸­æŸ¥è¯¢ä¸€äº›æ·»åŠ csså±æ€§çš„æ ·å¼;



### æ’ä»¶autoprefixerï¼ˆå¯ä¸ç”¨è¯¥æ’ä»¶ï¼‰

æ·»åŠ å‰ç¼€ï¼Œæ‰€ä»¥è¦å®‰è£…autoprefixer

```
 npm install autoprefixer -D
```

ç›´æ¥ä½¿ç”¨ä½¿ç”¨postcsså·¥å…·ï¼Œå¹¶ä¸”åˆ¶å®šä½¿ç”¨autoprefixer

```
 npx postcss --use autoprefixer -o end.css ./src/css/style.css
```





### postcss-loader

çœŸå®å¼€å‘ä¸­æˆ‘ä»¬å¿…ç„¶ä¸ä¼šç›´æ¥ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·æ¥å¯¹cssè¿›è¡Œå¤„ç†ï¼Œè€Œæ˜¯å¯ä»¥å€ŸåŠ©äºæ„å»ºå·¥å…·ã€‚åœ¨webpackä¸­ä½¿ç”¨postcsså°±æ˜¯ä½¿ç”¨postcss-loaderæ¥å¤„ç†çš„

```
 npm install postcss-loader -D
```

ä¿®æ”¹åŠ è½½cssçš„loaderã€‚æ³¨æ„:å› ä¸ºpostcsséœ€è¦æœ‰å¯¹åº”çš„æ’ä»¶æ‰ä¼šèµ·æ•ˆæœï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é…ç½®å®ƒçš„plugin

```js
{
    loader: 'postcss-loader',
        options: {
            postcssOptions: {
                plugins: [
                    require('autoprefixer')
                ]
            },
        },
},
```

å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†è¿™äº›é…ç½®ä¿¡æ¯æ”¾åˆ°ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­è¿›è¡Œç®¡ç†ï¼Œåœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºpostcss.config.js

```js
module.exports = {
  plugins: [
      require('autoprefixer')
  ],
}
```



### postcss-preset-env

äº‹å®ä¸Šï¼Œåœ¨é…ç½®postcss-loaderæ—¶ï¼Œæˆ‘ä»¬é…ç½®æ’ä»¶å¹¶ä¸éœ€è¦ä½¿ç”¨autoprefixerï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦å¤–ä¸€ä¸ªæ’ä»¶:postcss-preset-env

*   postcss-preset-envä¹Ÿæ˜¯ä¸€ä¸ªpostcssçš„æ’ä»¶;
*   å®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬å°†ä¸€äº›ç°ä»£çš„CSSç‰¹æ€§ï¼Œè½¬æˆå¤§å¤šæ•°æµè§ˆå™¨è®¤è¯†çš„CSSï¼Œå¹¶ä¸”ä¼šæ ¹æ®ç›®æ ‡æµè§ˆå™¨æˆ–è€…è¿è¡Œæ—¶ç¯å¢ƒ æ·»åŠ æ‰€éœ€çš„polyfill
*   ä¹ŸåŒ…æ‹¬ä¼šè‡ªåŠ¨å¸®åŠ©æˆ‘ä»¬æ·»åŠ autoprefixer(æ‰€ä»¥ç›¸å½“äºå·²ç»å†…ç½®äº†autoprefixer)

```
 npm install postcss-preset-env -D
```

ä¹‹åï¼Œæˆ‘ä»¬ç›´æ¥ä¿®æ”¹æ‰ä¹‹å‰çš„autoprefixerå³å¯

```js
module.exports = {
  plugins: [
      require('postcss-preset-env')
  ],
}
```

æ³¨æ„:æˆ‘ä»¬åœ¨ä½¿ç”¨æŸäº›postcssæ’ä»¶æ—¶ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä¼ å…¥å­—ç¬¦ä¸²

```js
module.exports = {
  plugins: [
      'postcss-preset-env'
  ],
}
```





### postcss å®Œæ•´é…ç½®

webpack.config.js

```js
module.exports = {
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [
          { loader: 'style-loader', options: {} },
          { loader: 'css-loader', options: {} },
          {
            loader: 'postcss-loader',
            options: {},
          },
        ],
      },
      {
        test: /\.less$/,
        use: [
          { loader: 'style-loader', options: {} },
          { loader: 'css-loader', options: {} },
          {
            loader: 'postcss-loader',
            options: {},
          },
          { loader: 'less-loader', options: {} },
        ],
      },
    ],
  },
}

```

postcss.config.js

```js
module.exports = {
  plugins: [require('postcss-preset-env')],
}
```







## æ‰“åŒ…èµ„æº

ä¸ºäº†æ¼”ç¤ºæˆ‘ä»¬é¡¹ç›®ä¸­å¯ä»¥åŠ è½½å›¾ç‰‡ï¼Œæˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›®ä¸­ä½¿ç”¨å›¾ç‰‡ï¼Œæ¯”è¾ƒå¸¸è§çš„ä½¿ç”¨å›¾ç‰‡çš„æ–¹å¼æ˜¯ä¸¤ç§

*   imgå…ƒç´ ï¼Œè®¾ç½®srcå±æ€§;
*   å…¶ä»–å…ƒç´ (æ¯”å¦‚div)ï¼Œè®¾ç½®background-imageçš„csså±æ€§;



### file-loader

è¦å¤„ç†jpgã€pngç­‰æ ¼å¼çš„å›¾ç‰‡ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦æœ‰å¯¹åº”çš„loader:**file-loader**

file-loaderçš„ä½œç”¨å°±æ˜¯å¸®åŠ©æˆ‘ä»¬å¤„ç†`import/require()`æ–¹å¼å¼•å…¥çš„ä¸€ä¸ªæ–‡ä»¶èµ„æºï¼Œå¹¶ä¸”ä¼šå°†å®ƒæ”¾åˆ°æˆ‘ä»¬è¾“å‡ºçš„æ–‡ä»¶å¤¹ä¸­;

å½“ç„¶æˆ‘ä»¬å¾…ä¼šå„¿å¯ä»¥å­¦ä¹ å¦‚ä½•ä¿®æ”¹å®ƒçš„åå­—å’Œæ‰€åœ¨æ–‡ä»¶å¤¹

```
npm install file-loader -D
```

æœ‰æ—¶å€™æˆ‘ä»¬å¤„ç†åçš„æ–‡ä»¶åç§°æŒ‰ç…§ä¸€å®šçš„è§„åˆ™è¿›è¡Œæ˜¾ç¤ºï¼Œæ¯”å¦‚ä¿ç•™åŸæ¥çš„æ–‡ä»¶åã€æ‰©å±•åï¼ŒåŒæ—¶ä¸ºäº†é˜²æ­¢é‡å¤ï¼ŒåŒ…å«ä¸€ä¸ªhashå€¼ç­‰;

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨PlaceHoldersæ¥å®Œæˆï¼Œwebpackç»™æˆ‘ä»¬æä¾›äº†å¤§é‡çš„PlaceHoldersæ¥æ˜¾ç¤ºä¸åŒçš„å†…å®¹: https://webpack.js.org/loaders/file-loader/#placeholdersã€‚æˆ‘ä»¬å¯ä»¥åœ¨æ–‡æ¡£ä¸­æŸ¥é˜…è‡ªå·±éœ€è¦çš„placeholder;

æˆ‘ä»¬è¿™é‡Œä»‹ç»å‡ ä¸ªæœ€å¸¸ç”¨çš„placeholder:

*   `[ext]`: å¤„ç†æ–‡ä»¶çš„æ‰©å±•å;
*   `[name]`:å¤„ç†æ–‡ä»¶çš„åç§°;
*   `[hash]`:æ–‡ä»¶çš„å†…å®¹ï¼Œä½¿ç”¨MD4çš„æ•£åˆ—å‡½æ•°å¤„ç†ï¼Œç”Ÿæˆçš„ä¸€ä¸ª128ä½çš„hashå€¼(32ä¸ªåå…­è¿›åˆ¶);
*   `[contentHash]`:åœ¨file-loaderä¸­å’Œ[hash]ç»“æœæ˜¯ä¸€è‡´çš„(åœ¨webpackçš„ä¸€äº›å…¶ä»–åœ°æ–¹ä¸ä¸€æ ·ï¼Œåé¢ä¼šè®²åˆ°); 
*   `[hash:<length>]`:æˆªå›¾hashçš„é•¿åº¦ï¼Œé»˜è®¤32ä¸ªå­—ç¬¦å¤ªé•¿äº†;
*   `[path]`:æ–‡ä»¶ç›¸å¯¹äºwebpacké…ç½®æ–‡ä»¶çš„è·¯å¾„;



#### å®Œæ•´é…ç½®

```js
{
        test: /\.(jpe?g|png|gif|svg)$/,
        use: {
          // file-loader å’Œ url-loader æ ¹æ®éœ€è¦é€‰æ‹©ä¸€ä¸ª
          loader: 'file-loader',
          // loader: 'url-loader',
          options: {
            // outputPath: "img",
            name: 'img/[name]_[hash:6].[ext]',
          },
        },
      },
```





### url-loader

**url-loaderå’Œfile-loader**çš„å·¥ä½œæ–¹å¼æ˜¯ç›¸ä¼¼çš„ï¼Œä½†æ˜¯å¯ä»¥å°†è¾ƒå°çš„æ–‡ä»¶ï¼Œè½¬æˆbase64çš„URI

```bash
 npm install url-loader -D
```

distæ–‡ä»¶å¤¹ä¸­ï¼Œæˆ‘ä»¬ä¼šçœ‹ä¸åˆ°å›¾ç‰‡æ–‡ä»¶:

*   è¿™æ˜¯å› ä¸ºæˆ‘çš„ä¸¤å¼ å›¾ç‰‡çš„å¤§å°åˆ†åˆ«æ˜¯38kbå’Œ295kb;
*   é»˜è®¤æƒ…å†µä¸‹url-loaderä¼šå°†æ‰€æœ‰çš„å›¾ç‰‡æ–‡ä»¶è½¬æˆbase64ç¼–ç 

ä½†æ˜¯å¼€å‘ä¸­æˆ‘ä»¬å¾€å¾€æ˜¯å°çš„å›¾ç‰‡éœ€è¦è½¬æ¢ï¼Œä½†æ˜¯å¤§çš„å›¾ç‰‡ç›´æ¥ä½¿ç”¨å›¾ç‰‡å³å¯

*   è¿™æ˜¯å› ä¸ºå°çš„å›¾ç‰‡è½¬æ¢base64ä¹‹åå¯ä»¥å’Œé¡µé¢ä¸€èµ·è¢«è¯·æ±‚ï¼Œå‡å°‘ä¸å¿…è¦çš„è¯·æ±‚è¿‡ç¨‹
*   è€Œå¤§çš„å›¾ç‰‡ä¹Ÿè¿›è¡Œè½¬æ¢ï¼Œåè€Œä¼šå½±å“é¡µé¢çš„è¯·æ±‚é€Ÿåº¦;

url-loaderæœ‰ä¸€ä¸ªoptionså±æ€§limitï¼Œå¯ä»¥ç”¨äºè®¾ç½®è½¬æ¢çš„é™åˆ¶;

```js
{
        test: /\.(jpe?g|png|gif|svg)$/,
        use: {
          // file-loader å’Œ url-loader æ ¹æ®éœ€è¦é€‰æ‹©ä¸€ä¸ª
          // loader: 'file-loader',
          loader: 'url-loader',
          options: {
            // outputPath: "img",
            name: 'img/[name]_[hash:6].[ext]',
            limit: 100 * 1024,
          },
        },
      },
```



### å­—ä½“æ–‡ä»¶

```js
{
        test: /\.(eot|ttf|woff2?)$/,
        use: {
          loader: "file-loader",
          options: {
            // outputPath: "font",
            name: "font/[name]_[hash:6].[ext]"
          }
        }
      },
```







### asset module type ğŸ”¥

**æˆ‘ä»¬å½“å‰ä½¿ç”¨çš„webpackç‰ˆæœ¬æ˜¯webpack5:** 

*   åœ¨webpack5ä¹‹å‰ï¼ŒåŠ è½½è¿™äº›èµ„æºæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸€äº›loaderï¼Œæ¯”å¦‚raw-loader ã€url-loaderã€file-loader; 
*   åœ¨webpack5å¼€å§‹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨èµ„æºæ¨¡å—ç±»å‹(asset module type)ï¼Œæ¥æ›¿ä»£ä¸Šé¢çš„è¿™äº›loader;

**èµ„æºæ¨¡å—ç±»å‹(asset module type)**ï¼Œé€šè¿‡æ·»åŠ  4 ç§æ–°çš„æ¨¡å—ç±»å‹ï¼Œæ¥æ›¿æ¢æ‰€æœ‰è¿™äº› loader: 

*   **asset/resource** å‘é€ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶å¹¶å¯¼å‡º URLã€‚ä¹‹å‰é€šè¿‡ä½¿ç”¨ file-loader å®ç°; 
*   **asset/inline** å¯¼å‡ºä¸€ä¸ªèµ„æºçš„ data URIã€‚ä¹‹å‰é€šè¿‡ä½¿ç”¨ url-loader å®ç°; 
*   **asset/source** å¯¼å‡ºèµ„æºçš„æºä»£ç ã€‚ä¹‹å‰é€šè¿‡ä½¿ç”¨ raw-loader å®ç°;
*   **asset** åœ¨å¯¼å‡ºä¸€ä¸ª data URI å’Œå‘é€ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¹‹é—´è‡ªåŠ¨é€‰æ‹©ã€‚ä¹‹å‰é€šè¿‡ä½¿ç”¨ url-loaderï¼Œå¹¶ä¸”é…ç½®èµ„æºä½“ ç§¯é™åˆ¶å®ç°;



#### å®Œæ•´é…ç½®

```js
// webpack5çš„asset module typeæ›¿æ¢file-loader å’Œ url-loaderç­‰
      {
        test: /\.(jpe?g|png|gif|svg)$/,
        type: 'asset',
        generator: {
          filename: 'img/[name]_[hash:6][ext]',
        },
        parser: {
          dataUrlCondition: {
            maxSize: 100 * 1024,
          },
        },
      },
          {
        test: /\.(eot|ttf|woff2?)$/,
        type: 'asset/resource',
        generator: {
          filename: 'font/[name]_[hash:6][ext]',
        },
      },
```

æ•ˆæœå’Œä¸Šè¿°url-loaderã€file-loaderä¸€æ ·ï¼ï¼ï¼







## Plugin

**Webpackçš„å¦ä¸€ä¸ªæ ¸å¿ƒæ˜¯Pluginï¼Œå®˜æ–¹æœ‰è¿™æ ·ä¸€æ®µå¯¹Pluginçš„æè¿°:**

While loaders are used to transform certain types of modules, plugins can be leveraged to perform a wider range of tasks like bundle optimization, asset management and injection of environment variables.

ä¸Šé¢è¡¨è¾¾çš„å«ä¹‰ç¿»è¯‘è¿‡æ¥å°±æ˜¯:

*   Loaderæ˜¯ç”¨äºç‰¹å®šçš„**æ¨¡å—ç±»å‹è¿›è¡Œè½¬æ¢**;
*   Pluginå¯ä»¥ç”¨äºæ‰§è¡Œæ›´åŠ å¹¿æ³›çš„ä»»åŠ¡ï¼Œæ¯”å¦‚**æ‰“åŒ…ä¼˜åŒ–ã€èµ„æºç®¡ç†ã€ç¯å¢ƒå˜é‡æ³¨å…¥**ç­‰;

![image-20220116224107667](./images/image-20220116224107667.png)



### CleanWebpackPlugin

å‰é¢æˆ‘ä»¬æ¼”ç¤ºçš„è¿‡ç¨‹ä¸­ï¼Œæ¯æ¬¡ä¿®æ”¹äº†ä¸€äº›é…ç½®ï¼Œé‡æ–°æ‰“åŒ…æ—¶ï¼Œéƒ½éœ€è¦æ‰‹åŠ¨åˆ é™¤distæ–‡ä»¶å¤¹ã€‚æˆ‘ä»¬å¯ä»¥å€ŸåŠ©äºä¸€ä¸ªæ’ä»¶æ¥å¸®åŠ©æˆ‘ä»¬å®Œæˆï¼Œè¿™ä¸ªæ’ä»¶å°±æ˜¯CleanWebpackPlugin

```bash
 npm install clean-webpack-plugin -D
```

é…ç½®

```js
const { CleanWebpackPlugin } = require("clean-webpack-plugin");

module.exports = {
  plugins: [
    new CleanWebpackPlugin(),
  ],
};
```





### HtmlWebpackPlugin

å¦å¤–è¿˜æœ‰ä¸€ä¸ª**ä¸å¤ªè§„èŒƒ**çš„åœ°æ–¹:

*   æˆ‘ä»¬çš„HTMLæ–‡ä»¶æ˜¯ç¼–å†™åœ¨æ ¹ç›®å½•ä¸‹çš„ï¼Œè€Œæœ€ç»ˆæ‰“åŒ…çš„distæ–‡ä»¶å¤¹ä¸­æ˜¯æ²¡æœ‰index.htmlæ–‡ä»¶çš„ã€‚ 
*   åœ¨è¿›è¡Œé¡¹ç›®éƒ¨ç½²çš„æ—¶ï¼Œå¿…ç„¶ä¹Ÿæ˜¯éœ€è¦æœ‰å¯¹åº”çš„å…¥å£æ–‡ä»¶index.html;
*   æ‰€ä»¥æˆ‘ä»¬ä¹Ÿéœ€è¦å¯¹index.htmlè¿›è¡Œæ‰“åŒ…å¤„ç†;

```bash
 npm install html-webpack-plugin -D
```

é…ç½®ï¼ˆå¯ä»¥åœ¨publicä¸­ä½¿ç”¨è‡ªå®šä¹‰æ¨¡æ¿ï¼‰

```js
const HtmlWebpackPlugin = require("html-webpack-plugin");


module.exports = {
  plugins: [
      new HtmlWebpackPlugin({
      	template: "./public/index.html",
      	title: "å“ˆå“ˆå“ˆå“ˆ"
      }),
  ],
};
```



### DefinePlugin

è¿™æ˜¯å› ä¸ºåœ¨ç¼–è¯‘templateæ¨¡å—æ—¶ï¼Œæœ‰ä¸€ä¸ªBASE_URL`<link rel="icon" href="<%= BASE_URL %>favicon.ico">`ä½†æ˜¯æˆ‘ä»¬å¹¶æ²¡æœ‰è®¾ç½®è¿‡è¿™ä¸ªå¸¸é‡å€¼ï¼Œæ‰€ä»¥ä¼šå‡ºç°æ²¡æœ‰å®šä¹‰çš„é”™è¯¯ï¼Œå¯ä»¥ä½¿ç”¨DefinePluginæ’ä»¶;

DefinePluginå…è®¸åœ¨ç¼–è¯‘æ—¶åˆ›å»ºé…ç½®çš„å…¨å±€å¸¸é‡ï¼Œæ˜¯ä¸€ä¸ªwebpackå†…ç½®çš„æ’ä»¶(ä¸éœ€è¦å•ç‹¬å®‰è£…)

```js
const { DefinePlugin } = require("webpack");

module.exports = {
  plugins: [
      new DefinePlugin({
      	BASE_URL: "'./'"
      }),
  ],
};
```





### CopyWebpackPlugin

åœ¨vueçš„æ‰“åŒ…è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæˆ‘ä»¬å°†ä¸€äº›æ–‡ä»¶æ”¾åˆ°publicçš„ç›®å½•ä¸‹ï¼Œé‚£ä¹ˆè¿™ä¸ªç›®å½•ä¼šè¢«å¤åˆ¶åˆ°distæ–‡ä»¶å¤¹ä¸­ã€‚ è¿™ä¸ªå¤åˆ¶çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨CopyWebpackPluginæ¥å®Œæˆ;

```bash
 npm install copy-webpack-plugin -D
```

é…ç½®CopyWebpackPluginï¼š

*   å¤åˆ¶çš„è§„åˆ™åœ¨patternsä¸­è®¾ç½®;
*   **from:**è®¾ç½®ä»å“ªä¸€ä¸ªæºä¸­å¼€å§‹å¤åˆ¶;
*   **to:**å¤åˆ¶åˆ°çš„ä½ç½®ï¼Œå¯ä»¥çœç•¥ï¼Œä¼šé»˜è®¤å¤åˆ¶åˆ°æ‰“åŒ…çš„ç›®å½•ä¸‹;
*   **globOptions:**è®¾ç½®ä¸€äº›é¢å¤–çš„é€‰é¡¹ï¼Œå…¶ä¸­å¯ä»¥ç¼–å†™éœ€è¦å¿½ç•¥çš„æ–‡ä»¶:
    *   .DS_Store:macç›®å½•ä¸‹å›è‡ªåŠ¨ç”Ÿæˆçš„ä¸€ä¸ªæ–‡ä»¶;
    *   index.html:ä¹Ÿä¸éœ€è¦å¤åˆ¶ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»é€šè¿‡HtmlWebpackPluginå®Œæˆäº†index.htmlçš„ç”Ÿæˆ;

```js
const CopyWebpackPlugin = require('copy-webpack-plugin');

module.exports = {
  plugins: [
      new CopyWebpackPlugin({
      patterns: [
        {
          from: "public",
          to: "./",
          globOptions: {
            ignore: [
              "**/index.html"
            ]
          }
        }
      ]
    })
  ],
};
```





## Modeé…ç½®

Modeé…ç½®é€‰é¡¹ï¼Œå¯ä»¥å‘ŠçŸ¥webpackä½¿ç”¨å“åº”æ¨¡å¼çš„å†…ç½®ä¼˜åŒ–: 

*   é»˜è®¤å€¼æ˜¯production(ä»€ä¹ˆéƒ½ä¸è®¾ç½®çš„æƒ…å†µä¸‹); 
*   å¯é€‰å€¼æœ‰:'none' | 'development' | 'production'

![image-20220116225529127](./images/image-20220116225529127.png)



```js
  // è®¾ç½®æ¨¡å¼
  // development å¼€å‘é˜¶æ®µ, ä¼šè®¾ç½®development
  // production å‡†å¤‡æ‰“åŒ…ä¸Šçº¿çš„æ—¶å€™, è®¾ç½®production
  mode: "development",
  // è®¾ç½®source-map, å»ºç«‹jsæ˜ å°„æ–‡ä»¶, æ–¹ä¾¿è°ƒè¯•ä»£ç å’Œé”™è¯¯
  devtool: "source-map",
```



