---
title: å…¥é—¨
date: 2022-01-16 16:41:40
permalink: /pages/6f1f8f/
categories:
  - Node
  - Webpack5
tags:
  -
---

# å…¥é—¨

## ä»‹ç»

æœ¬è´¨ä¸Šï¼Œ**webpack** æ˜¯ä¸€ä¸ªç”¨äºç°ä»£ JavaScript åº”ç”¨ç¨‹åºçš„ ***é™æ€æ¨¡å—æ‰“åŒ…å·¥å…·***ã€‚å½“ webpack å¤„ç†åº”ç”¨ç¨‹åºæ—¶ï¼Œå®ƒä¼šåœ¨å†…éƒ¨ä»ä¸€ä¸ªæˆ–å¤šä¸ªå…¥å£ç‚¹æ„å»ºä¸€ä¸ª [ä¾èµ–å›¾(dependency graph)](https://webpack.docschina.org/concepts/dependency-graph/)ï¼Œç„¶åå°†ä½ é¡¹ç›®ä¸­æ‰€éœ€çš„æ¯ä¸€ä¸ªæ¨¡å—ç»„åˆæˆä¸€ä¸ªæˆ–å¤šä¸ª *bundles*ï¼Œå®ƒä»¬å‡ä¸ºé™æ€èµ„æºï¼Œç”¨äºå±•ç¤ºä½ çš„å†…å®¹ã€‚

*   ç°ä»£çš„modernï¼šæˆ‘ä»¬å‰ç«¯è¯´è¿‡ï¼Œæ­£æ˜¯å› ä¸ºç°ä»£å‰ç«¯å¼€å‘é¢ä¸´å„ç§å„æ ·çš„é—®é¢˜ï¼Œæ‰å‚¬ç”Ÿäº†webpackçš„å‡ºç°å’Œå‘å±•
*   é™æ€çš„staticï¼šè¿™æ ·è¡¨è¿°çš„åŸå› æ˜¯æˆ‘ä»¬æœ€ç»ˆå¯ä»¥å°†ä»£ç æ‰“åŒ…æˆæœ€ç»ˆçš„é™æ€èµ„æº(éƒ¨ç½²åˆ°é™æ€æœåŠ¡å™¨)
*   æ¨¡å—åŒ–moduleï¼šwebpacké»˜è®¤æ”¯æŒå„ç§æ¨¡å—åŒ–å¼€å‘ï¼ŒES Moduleã€CommonJSã€AMDç­‰
*   æ‰“åŒ…bundlerï¼šwebpackå¯ä»¥å°†å¸®åŠ©æˆ‘ä»¬è¿›è¡Œæ‰“åŒ…ï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸€ä¸ªæ‰“åŒ…å·¥å…·





## æ‰“åŒ…çš„ä¸œè¥¿

**JavaScriptçš„æ‰“åŒ…**:

*   ES6è½¬æ¢æˆES5çš„è¯­æ³•;
*   TypeScriptçš„å¤„ç†ï¼Œå°†å…¶è½¬æ¢æˆJavaScript;

**Cssçš„å¤„ç†**:

*   CSSæ–‡ä»¶æ¨¡å—çš„åŠ è½½ã€æå–;
*   Lessã€Sassç­‰é¢„å¤„ç†å™¨çš„å¤„ç†;

**èµ„æºæ–‡ä»¶imgã€font**:

*   å›¾ç‰‡imgæ–‡ä»¶çš„åŠ è½½; 
*   å­—ä½“fontæ–‡ä»¶çš„åŠ è½½;

**HTMLèµ„æºçš„å¤„ç†**

*   æ‰“åŒ…HTMLèµ„æºæ–‡ä»¶;

**å¤„ç†vueé¡¹ç›®çš„SFCæ–‡ä»¶.vueæ–‡ä»¶;**





## Node å’Œ NPM ç‰ˆæœ¬

ç›®å‰ä½¿ç”¨çš„ç‰ˆæœ¬

```bash
v14.18.3
6.14.15
```





## webpack & webpack-cli

webpackçš„å®‰è£…ç›®å‰åˆ†ä¸ºä¸¤ä¸ªï¼šwebpackã€webpack-cli

Â·é‚£ä¹ˆå®ƒä»¬æ˜¯ä»€ä¹ˆå…³ç³»å‘¢?

*   æ‰§è¡Œwebpackå‘½ä»¤ï¼Œä¼šæ‰§è¡Œnode_modulesä¸‹çš„.binç›®å½•ä¸‹çš„webpack;
*   webpackåœ¨æ‰§è¡Œæ—¶æ˜¯ä¾èµ–webpack-cliçš„ï¼Œå¦‚æœæ²¡æœ‰å®‰è£…å°±ä¼šæŠ¥é”™;
*   è€Œwebpack-cliä¸­ä»£ç æ‰§è¡Œæ—¶ï¼Œæ‰æ˜¯çœŸæ­£åˆ©ç”¨webpackè¿›è¡Œç¼–è¯‘å’Œæ‰“åŒ…çš„è¿‡ç¨‹;
*   æ‰€ä»¥åœ¨å®‰è£…webpackæ—¶ï¼Œæˆ‘ä»¬éœ€è¦åŒæ—¶å®‰è£…webpack-cli(ç¬¬ä¸‰æ–¹çš„è„šæ‰‹æ¶äº‹å®ä¸Šæ˜¯æ²¡æœ‰ä½¿ç”¨webpack-cliçš„ï¼Œè€Œæ˜¯ç±»ä¼¼äºè‡ªå·±çš„vue-service-cliçš„ä¸œè¥¿)

![image-20220116170535399](./images/image-20220116170535399.png)







## å…¨å±€ webpack æ‰“åŒ…

å®‰è£…

```bash
npm install webpack webpack-cli â€“g # å…¨å±€å®‰è£… 
```



åˆ›å»ºå¦‚ä¸‹æ–‡ä»¶

![image-20220116172022406](./images/image-20220116172022406.png)

/index.html

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <!-- æºjsæ–‡ä»¶æ— æ³•è¿è¡Œ -->
    <script src="./src/index.js" type="module"></script>
  </body>
</html>
```

/src/index.js

```js
import { sum } from "./js/math";
const { priceFormat } = require("./js/format");

console.log(sum(20, 30));
console.log(priceFormat());
```

/src/js/format.js

```js
const priceFormat = function() {
  return "Â¥99.88";
}

// CommonJSçš„å¯¼å‡º
module.exports = {
  priceFormat
}
```

/src/js/math.js

```js
// ES Module
export function sum(num1, num2) {
  return num1 + num2;
}
```

åœ¨é¡¹ç›®`/`ç›®å½•ä¸‹æ‰§è¡Œ`webpack`ï¼Œä¼šç”Ÿæˆ`/dist/main.js`ï¼Œå°†htmlæ›¿æ¢ä¸º

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <!-- æºjsæ–‡ä»¶æ— æ³•è¿è¡Œ -->
    <!-- <script src="./src/index.js" type="module"></script> -->
    <!-- æ‰“åŒ…åçš„jsæ–‡ä»¶å¯ä»¥è®¿é—® -->
    <script src="./dist/main.js"></script>
  </body>
</html>
```

å°±ä¼šè¿è¡ŒæˆåŠŸï¼







## å±€éƒ¨ webpack æ‰“åŒ… ğŸ”¥

```bash
npm init
npm install webpack webpack-cli -D
npx webpack
```

`npx`æ„æ€æ˜¯åœ¨`npm`å®‰è£…çš„`node_modules`ä¸­çš„`.bin`ç›®å½•ä¸‹æŸ¥æ‰¾å‘½ä»¤

åœ¨package.jsonä¸­åˆ›å»ºscriptsè„šæœ¬ï¼Œæ‰§è¡Œè„šæœ¬æ‰“åŒ…å³å¯

```json
  "scripts": {
    "build": "webpack"
  },
```

æ­¤æ—¶åªå†™webpackï¼Œå®ƒä¼šè‡ªåŠ¨å…ˆåœ¨`node_modules`ä¸­çš„`.bin`ç›®å½•ä¸‹æŸ¥æ‰¾å‘½ä»¤ã€‚æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å³å¯æ‰“åŒ…

```
npm run build
```







## å…¥å£ã€å‡ºå£æ–‡ä»¶é…ç½® ğŸ”¥

å½“æˆ‘ä»¬è¿è¡Œ`webpack`æ—¶ï¼Œwebpackä¼šæŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹çš„ `src/index.js`ä½œä¸ºå…¥å£ï¼Œä¸å­˜åœ¨åˆ™æŠ¥é”™

**å¯ä»¥é€šè¿‡é…ç½®æ¥æŒ‡å®šå…¥å£å’Œå‡ºå£**ï¼š

```bash
 npx webpack --entry ./src/main.js --output-path ./build
```

ä½†æ˜¯ä¸æ¨èè¯¥æ–¹å¼ï¼Œå¯ä»¥åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º`wepack.config.js`æ–‡ä»¶

```js
const path = require('path')

// Webpackåœ¨Nodeç¯å¢ƒè¿è¡Œï¼ŒNodeä½¿ç”¨çš„CommonJSï¼Œè¦æ”¹ä¸ºES6éœ€è¦é…ç½®ï¼Œæ¯”è¾ƒéº»çƒ¦
module.exports = {
  // å…¥å£æ–‡ä»¶å
  entry: './src/main.js',
  output: {
    // pathå¿…é¡»æ˜¯ç»å¯¹è·¯å¾„ï¼ï¼ï¼ï¼Œ__dirnameä»£è¡¨å½“å‰æ–‡ä»¶ï¼ˆwebpack.config.jsï¼‰æ‰€åœ¨ç»å¯¹è·¯å¾„
    path: path.resolve(__dirname, './build'),
    filename: 'bundle.js',
  },
}
```

åœ¨package.jsonä¸­ä¿®æ”¹scriptsè„šæœ¬å³å¯ä½¿ç”¨

```json
"build": "webpack"
```

è‹¥æ˜¯åˆ›å»ºçš„æ–‡ä»¶åä¸æ˜¯é»˜è®¤çš„ï¼Œè€Œæ˜¯å¦‚`  conana.config.js`ï¼Œåˆ™éœ€è¦ä¿®æ”¹scriptsè„šæœ¬ã€‚ä¸æ¨èï¼ï¼ï¼

```json
"build": "webpack --config conana.config.js"
```







## Webpackçš„ä¾èµ–å›¾

![image-20200614121215477](./images/image-20200614121215477.png)

*   äº‹å®ä¸Šwebpackåœ¨å¤„ç†åº”ç”¨ç¨‹åºæ—¶ï¼Œå®ƒä¼šæ ¹æ®å‘½ä»¤æˆ–è€…é…ç½®æ–‡ä»¶æ‰¾åˆ°å…¥å£æ–‡ä»¶
*   ä»å…¥å£å¼€å§‹ï¼Œä¼šç”Ÿæˆä¸€ä¸ªä¾èµ–å…³ç³»å›¾ï¼Œè¿™ä¸ªä¾èµ–å…³ç³»å›¾ä¼šåŒ…å«åº”ç”¨ç¨‹åºä¸­æ‰€éœ€çš„æ‰€æœ‰æ¨¡å—(æ¯”å¦‚.jsæ–‡ä»¶ã€cssæ–‡ä»¶ã€å›¾ç‰‡ã€å­— ä½“ç­‰)
*   ç„¶åéå†å›¾ç»“æ„ï¼Œæ‰“åŒ…ä¸€ä¸ªä¸ªæ¨¡å—(æ ¹æ®æ–‡ä»¶çš„ä¸åŒä½¿ç”¨ä¸åŒçš„loaderæ¥è§£æ)
*   æ³¨æ„ï¼Œ**æ²¡æœ‰ä¾èµ–åˆ°çš„ä¸ä¼šæ‰“åŒ…**ï¼ï¼ï¼









## æ‰“åŒ… css

`css-loader` æ˜¯å°† css è§£æã€è£…è½½ï¼›`style-loader` æ˜¯å°†è§£æã€è£…è½½çš„ css æ·»åŠ åˆ° style æ ‡ç­¾ä¸­ã€‚

```bash
npm install css-loader style-loader -D
```

é…ç½®webpack.config.js

```js
module.exports = {\
  module: {
    rules: [
      {
        test: /\.css$/,
        // loader: 'css-loader',
        // use: ['css-loader'],
        // å®Œæ•´å†™æ³•(å€’åºæ‰§è¡Œï¼ï¼ï¼)
        use: [
          { loader: 'style-loader', options: {} },
          { loader: 'css-loader', options: {} },
        ],
      },
    ],
  },
}
```





## æ‰“åŒ… lessã€scssã€stylus

è¿™é‡Œä»¥ less ä¸ºä¾‹ã€‚`less`ä¼šå°†lessæ–‡ä»¶è½¬æ¢ä¸ºcssæ–‡ä»¶ï¼Œå®‰è£…åä¼šæœ‰ä¸ª`lessc`å¯æ‰§è¡Œæ–‡ä»¶ï¼›`less-loader`ä¼šæ‰¹é‡å°†lessæ–‡ä»¶è½¬ä¸ºcssæ–‡ä»¶

```
npm install less less-loader -D
```

é…ç½®webpack.config.js

```js
gmodule.exports = {
  module: {
    rules: [
      {
        test: /\.less$/,
        use: [
          { loader: 'style-loader', options: {} },
          { loader: 'css-loader', options: {} },
          { loader: 'less-loader', options: {} },
        ],
      },
    ],
  },
}
```





## PostCSS

CSSçš„è½¬æ¢å’Œé€‚é…ï¼Œæ¯”å¦‚è‡ªåŠ¨æ·»åŠ æµè§ˆå™¨å‰ç¼€ã€cssæ ·å¼çš„é‡ç½®ã€‚å®ç°è¿™äº›åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦å€ŸåŠ©äºPostCSSå¯¹åº”çš„æ’ä»¶

å¦‚ä½•ä½¿ç”¨PostCSSå‘¢?ä¸»è¦å°±æ˜¯ä¸¤ä¸ªæ­¥éª¤:

*   ç¬¬ä¸€æ­¥:æŸ¥æ‰¾PostCSSåœ¨æ„å»ºå·¥å…·ä¸­çš„æ‰©å±•ï¼Œæ¯”å¦‚webpackä¸­çš„postcss-loader; 
*   ç¬¬äºŒæ­¥:é€‰æ‹©å¯ä»¥æ·»åŠ ä½ éœ€è¦çš„PostCSSç›¸å…³çš„æ’ä»¶;



### å®‰è£… postcssã€postcss-cli

```bash
npm install postcss postcss-cli -D
```

postcss-cliå¯ä»¥ç›´æ¥åœ¨ç»ˆç«¯ä½¿ç”¨PostCSS

æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªéœ€è¦æ·»åŠ å‰ç¼€çš„csshttps://autoprefixer.github.io/ï¼Œåœ¨è¯¥ç½‘ç«™ä¸­æŸ¥è¯¢ä¸€äº›æ·»åŠ csså±æ€§çš„æ ·å¼;



### æ’ä»¶autoprefixerï¼ˆå¯ä¸ç”¨è¯¥æ’ä»¶ï¼‰

æ·»åŠ å‰ç¼€ï¼Œæ‰€ä»¥è¦å®‰è£…autoprefixer

```
 npm install autoprefixer -D
```

ç›´æ¥ä½¿ç”¨ä½¿ç”¨postcsså·¥å…·ï¼Œå¹¶ä¸”åˆ¶å®šä½¿ç”¨autoprefixer

```
 npx postcss --use autoprefixer -o end.css ./src/css/style.css
```





### postcss-loader

çœŸå®å¼€å‘ä¸­æˆ‘ä»¬å¿…ç„¶ä¸ä¼šç›´æ¥ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·æ¥å¯¹cssè¿›è¡Œå¤„ç†ï¼Œè€Œæ˜¯å¯ä»¥å€ŸåŠ©äºæ„å»ºå·¥å…·ã€‚åœ¨webpackä¸­ä½¿ç”¨postcsså°±æ˜¯ä½¿ç”¨postcss-loaderæ¥å¤„ç†çš„

```
 npm install postcss-loader -D
```

ä¿®æ”¹åŠ è½½cssçš„loaderã€‚æ³¨æ„:å› ä¸ºpostcsséœ€è¦æœ‰å¯¹åº”çš„æ’ä»¶æ‰ä¼šèµ·æ•ˆæœï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é…ç½®å®ƒçš„plugin

```js
{
    loader: 'postcss-loader',
        options: {
            postcssOptions: {
                plugins: [
                    require('autoprefixer')
                ]
            },
        },
},
```

å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†è¿™äº›é…ç½®ä¿¡æ¯æ”¾åˆ°ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­è¿›è¡Œç®¡ç†ï¼Œåœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºpostcss.config.js

```js
module.exports = {
  plugins: [
      require('autoprefixer')
  ],
}
```



### postcss-preset-env

äº‹å®ä¸Šï¼Œåœ¨é…ç½®postcss-loaderæ—¶ï¼Œæˆ‘ä»¬é…ç½®æ’ä»¶å¹¶ä¸éœ€è¦ä½¿ç”¨autoprefixerï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦å¤–ä¸€ä¸ªæ’ä»¶:postcss-preset-env

*   postcss-preset-envä¹Ÿæ˜¯ä¸€ä¸ªpostcssçš„æ’ä»¶;
*   å®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬å°†ä¸€äº›ç°ä»£çš„CSSç‰¹æ€§ï¼Œè½¬æˆå¤§å¤šæ•°æµè§ˆå™¨è®¤è¯†çš„CSSï¼Œå¹¶ä¸”ä¼šæ ¹æ®ç›®æ ‡æµè§ˆå™¨æˆ–è€…è¿è¡Œæ—¶ç¯å¢ƒ æ·»åŠ æ‰€éœ€çš„polyfill
*   ä¹ŸåŒ…æ‹¬ä¼šè‡ªåŠ¨å¸®åŠ©æˆ‘ä»¬æ·»åŠ autoprefixer(æ‰€ä»¥ç›¸å½“äºå·²ç»å†…ç½®äº†autoprefixer)

```
 npm install postcss-preset-env -D
```

ä¹‹åï¼Œæˆ‘ä»¬ç›´æ¥ä¿®æ”¹æ‰ä¹‹å‰çš„autoprefixerå³å¯

```js
module.exports = {
  plugins: [
      require('postcss-preset-env')
  ],
}
```

æ³¨æ„:æˆ‘ä»¬åœ¨ä½¿ç”¨æŸäº›postcssæ’ä»¶æ—¶ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä¼ å…¥å­—ç¬¦ä¸²

```js
module.exports = {
  plugins: [
      'postcss-preset-env'
  ],
}
```





### postcss å®Œæ•´é…ç½®

webpack.config.js

```js
module.exports = {
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [
          { loader: 'style-loader', options: {} },
          { loader: 'css-loader', options: {} },
          {
            loader: 'postcss-loader',
            options: {},
          },
        ],
      },
      {
        test: /\.less$/,
        use: [
          { loader: 'style-loader', options: {} },
          { loader: 'css-loader', options: {} },
          {
            loader: 'postcss-loader',
            options: {},
          },
          { loader: 'less-loader', options: {} },
        ],
      },
    ],
  },
}

```

postcss.config.js

```js
module.exports = {
  plugins: [require('postcss-preset-env')],
}
```







## æ‰“åŒ…èµ„æº

ä¸ºäº†æ¼”ç¤ºæˆ‘ä»¬é¡¹ç›®ä¸­å¯ä»¥åŠ è½½å›¾ç‰‡ï¼Œæˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›®ä¸­ä½¿ç”¨å›¾ç‰‡ï¼Œæ¯”è¾ƒå¸¸è§çš„ä½¿ç”¨å›¾ç‰‡çš„æ–¹å¼æ˜¯ä¸¤ç§

*   imgå…ƒç´ ï¼Œè®¾ç½®srcå±æ€§;
*   å…¶ä»–å…ƒç´ (æ¯”å¦‚div)ï¼Œè®¾ç½®background-imageçš„csså±æ€§;



### file-loader

è¦å¤„ç†jpgã€pngç­‰æ ¼å¼çš„å›¾ç‰‡ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦æœ‰å¯¹åº”çš„loader:**file-loader**

file-loaderçš„ä½œç”¨å°±æ˜¯å¸®åŠ©æˆ‘ä»¬å¤„ç†`import/require()`æ–¹å¼å¼•å…¥çš„ä¸€ä¸ªæ–‡ä»¶èµ„æºï¼Œå¹¶ä¸”ä¼šå°†å®ƒæ”¾åˆ°æˆ‘ä»¬è¾“å‡ºçš„æ–‡ä»¶å¤¹ä¸­;

å½“ç„¶æˆ‘ä»¬å¾…ä¼šå„¿å¯ä»¥å­¦ä¹ å¦‚ä½•ä¿®æ”¹å®ƒçš„åå­—å’Œæ‰€åœ¨æ–‡ä»¶å¤¹

```
npm install file-loader -D
```

æœ‰æ—¶å€™æˆ‘ä»¬å¤„ç†åçš„æ–‡ä»¶åç§°æŒ‰ç…§ä¸€å®šçš„è§„åˆ™è¿›è¡Œæ˜¾ç¤ºï¼Œæ¯”å¦‚ä¿ç•™åŸæ¥çš„æ–‡ä»¶åã€æ‰©å±•åï¼ŒåŒæ—¶ä¸ºäº†é˜²æ­¢é‡å¤ï¼ŒåŒ…å«ä¸€ä¸ªhashå€¼ç­‰;

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨PlaceHoldersæ¥å®Œæˆï¼Œwebpackç»™æˆ‘ä»¬æä¾›äº†å¤§é‡çš„PlaceHoldersæ¥æ˜¾ç¤ºä¸åŒçš„å†…å®¹: https://webpack.js.org/loaders/file-loader/#placeholdersã€‚æˆ‘ä»¬å¯ä»¥åœ¨æ–‡æ¡£ä¸­æŸ¥é˜…è‡ªå·±éœ€è¦çš„placeholder;

æˆ‘ä»¬è¿™é‡Œä»‹ç»å‡ ä¸ªæœ€å¸¸ç”¨çš„placeholder:

*   `[ext]`: å¤„ç†æ–‡ä»¶çš„æ‰©å±•å;
*   `[name]`:å¤„ç†æ–‡ä»¶çš„åç§°;
*   `[hash]`:æ–‡ä»¶çš„å†…å®¹ï¼Œä½¿ç”¨MD4çš„æ•£åˆ—å‡½æ•°å¤„ç†ï¼Œç”Ÿæˆçš„ä¸€ä¸ª128ä½çš„hashå€¼(32ä¸ªåå…­è¿›åˆ¶);
*   `[contentHash]`:åœ¨file-loaderä¸­å’Œ[hash]ç»“æœæ˜¯ä¸€è‡´çš„(åœ¨webpackçš„ä¸€äº›å…¶ä»–åœ°æ–¹ä¸ä¸€æ ·ï¼Œåé¢ä¼šè®²åˆ°); 
*   `[hash:<length>]`:æˆªå›¾hashçš„é•¿åº¦ï¼Œé»˜è®¤32ä¸ªå­—ç¬¦å¤ªé•¿äº†;
*   `[path]`:æ–‡ä»¶ç›¸å¯¹äºwebpacké…ç½®æ–‡ä»¶çš„è·¯å¾„;



#### å®Œæ•´é…ç½®

```js
{
        test: /\.(jpe?g|png|gif|svg)$/,
        use: {
          // file-loader å’Œ url-loader æ ¹æ®éœ€è¦é€‰æ‹©ä¸€ä¸ª
          loader: 'file-loader',
          // loader: 'url-loader',
          options: {
            // outputPath: "img",
            name: 'img/[name]_[hash:6].[ext]',
          },
        },
      },
```





### url-loader

**url-loaderå’Œfile-loader**çš„å·¥ä½œæ–¹å¼æ˜¯ç›¸ä¼¼çš„ï¼Œä½†æ˜¯å¯ä»¥å°†è¾ƒå°çš„æ–‡ä»¶ï¼Œè½¬æˆbase64çš„URI

```bash
 npm install url-loader -D
```

distæ–‡ä»¶å¤¹ä¸­ï¼Œæˆ‘ä»¬ä¼šçœ‹ä¸åˆ°å›¾ç‰‡æ–‡ä»¶:

*   è¿™æ˜¯å› ä¸ºæˆ‘çš„ä¸¤å¼ å›¾ç‰‡çš„å¤§å°åˆ†åˆ«æ˜¯38kbå’Œ295kb;
*   é»˜è®¤æƒ…å†µä¸‹url-loaderä¼šå°†æ‰€æœ‰çš„å›¾ç‰‡æ–‡ä»¶è½¬æˆbase64ç¼–ç 

ä½†æ˜¯å¼€å‘ä¸­æˆ‘ä»¬å¾€å¾€æ˜¯å°çš„å›¾ç‰‡éœ€è¦è½¬æ¢ï¼Œä½†æ˜¯å¤§çš„å›¾ç‰‡ç›´æ¥ä½¿ç”¨å›¾ç‰‡å³å¯

*   è¿™æ˜¯å› ä¸ºå°çš„å›¾ç‰‡è½¬æ¢base64ä¹‹åå¯ä»¥å’Œé¡µé¢ä¸€èµ·è¢«è¯·æ±‚ï¼Œå‡å°‘ä¸å¿…è¦çš„è¯·æ±‚è¿‡ç¨‹
*   è€Œå¤§çš„å›¾ç‰‡ä¹Ÿè¿›è¡Œè½¬æ¢ï¼Œåè€Œä¼šå½±å“é¡µé¢çš„è¯·æ±‚é€Ÿåº¦;

url-loaderæœ‰ä¸€ä¸ªoptionså±æ€§limitï¼Œå¯ä»¥ç”¨äºè®¾ç½®è½¬æ¢çš„é™åˆ¶;

```js
{
        test: /\.(jpe?g|png|gif|svg)$/,
        use: {
          // file-loader å’Œ url-loader æ ¹æ®éœ€è¦é€‰æ‹©ä¸€ä¸ª
          // loader: 'file-loader',
          loader: 'url-loader',
          options: {
            // outputPath: "img",
            name: 'img/[name]_[hash:6].[ext]',
            limit: 100 * 1024,
          },
        },
      },
```



### å­—ä½“æ–‡ä»¶

```js
{
        test: /\.(eot|ttf|woff2?)$/,
        use: {
          loader: "file-loader",
          options: {
            // outputPath: "font",
            name: "font/[name]_[hash:6].[ext]"
          }
        }
      },
```







### asset module type ğŸ”¥

**æˆ‘ä»¬å½“å‰ä½¿ç”¨çš„webpackç‰ˆæœ¬æ˜¯webpack5:** 

*   åœ¨webpack5ä¹‹å‰ï¼ŒåŠ è½½è¿™äº›èµ„æºæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸€äº›loaderï¼Œæ¯”å¦‚raw-loader ã€url-loaderã€file-loader; 
*   åœ¨webpack5å¼€å§‹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨èµ„æºæ¨¡å—ç±»å‹(asset module type)ï¼Œæ¥æ›¿ä»£ä¸Šé¢çš„è¿™äº›loader;

**èµ„æºæ¨¡å—ç±»å‹(asset module type)**ï¼Œé€šè¿‡æ·»åŠ  4 ç§æ–°çš„æ¨¡å—ç±»å‹ï¼Œæ¥æ›¿æ¢æ‰€æœ‰è¿™äº› loader: 

*   **asset/resource** å‘é€ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶å¹¶å¯¼å‡º URLã€‚ä¹‹å‰é€šè¿‡ä½¿ç”¨ file-loader å®ç°; 
*   **asset/inline** å¯¼å‡ºä¸€ä¸ªèµ„æºçš„ data URIã€‚ä¹‹å‰é€šè¿‡ä½¿ç”¨ url-loader å®ç°; 
*   **asset/source** å¯¼å‡ºèµ„æºçš„æºä»£ç ã€‚ä¹‹å‰é€šè¿‡ä½¿ç”¨ raw-loader å®ç°;
*   **asset** åœ¨å¯¼å‡ºä¸€ä¸ª data URI å’Œå‘é€ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¹‹é—´è‡ªåŠ¨é€‰æ‹©ã€‚ä¹‹å‰é€šè¿‡ä½¿ç”¨ url-loaderï¼Œå¹¶ä¸”é…ç½®èµ„æºä½“ ç§¯é™åˆ¶å®ç°;



#### å®Œæ•´é…ç½®

```js
// webpack5çš„asset module typeæ›¿æ¢file-loader å’Œ url-loaderç­‰
      {
        test: /\.(jpe?g|png|gif|svg)$/,
        type: 'asset',
        generator: {
          filename: 'img/[name]_[hash:6][ext]',
        },
        parser: {
          dataUrlCondition: {
            maxSize: 100 * 1024,
          },
        },
      },
          {
        test: /\.(eot|ttf|woff2?)$/,
        type: 'asset/resource',
        generator: {
          filename: 'font/[name]_[hash:6][ext]',
        },
      },
```

æ•ˆæœå’Œä¸Šè¿°url-loaderã€file-loaderä¸€æ ·ï¼ï¼ï¼







## Plugin

**Webpackçš„å¦ä¸€ä¸ªæ ¸å¿ƒæ˜¯Pluginï¼Œå®˜æ–¹æœ‰è¿™æ ·ä¸€æ®µå¯¹Pluginçš„æè¿°:**

While loaders are used to transform certain types of modules, plugins can be leveraged to perform a wider range of tasks like bundle optimization, asset management and injection of environment variables.

ä¸Šé¢è¡¨è¾¾çš„å«ä¹‰ç¿»è¯‘è¿‡æ¥å°±æ˜¯:

*   Loaderæ˜¯ç”¨äºç‰¹å®šçš„**æ¨¡å—ç±»å‹è¿›è¡Œè½¬æ¢**;
*   Pluginå¯ä»¥ç”¨äºæ‰§è¡Œæ›´åŠ å¹¿æ³›çš„ä»»åŠ¡ï¼Œæ¯”å¦‚**æ‰“åŒ…ä¼˜åŒ–ã€èµ„æºç®¡ç†ã€ç¯å¢ƒå˜é‡æ³¨å…¥**ç­‰;

![image-20220116224107667](./images/image-20220116224107667.png)



### CleanWebpackPlugin

å‰é¢æˆ‘ä»¬æ¼”ç¤ºçš„è¿‡ç¨‹ä¸­ï¼Œæ¯æ¬¡ä¿®æ”¹äº†ä¸€äº›é…ç½®ï¼Œé‡æ–°æ‰“åŒ…æ—¶ï¼Œéƒ½éœ€è¦æ‰‹åŠ¨åˆ é™¤distæ–‡ä»¶å¤¹ã€‚æˆ‘ä»¬å¯ä»¥å€ŸåŠ©äºä¸€ä¸ªæ’ä»¶æ¥å¸®åŠ©æˆ‘ä»¬å®Œæˆï¼Œè¿™ä¸ªæ’ä»¶å°±æ˜¯CleanWebpackPlugin

```bash
 npm install clean-webpack-plugin -D
```

é…ç½®

```js
const { CleanWebpackPlugin } = require("clean-webpack-plugin");

module.exports = {
  plugins: [
    new CleanWebpackPlugin(),
  ],
};
```





### HtmlWebpackPlugin

å¦å¤–è¿˜æœ‰ä¸€ä¸ª**ä¸å¤ªè§„èŒƒ**çš„åœ°æ–¹:

*   æˆ‘ä»¬çš„HTMLæ–‡ä»¶æ˜¯ç¼–å†™åœ¨æ ¹ç›®å½•ä¸‹çš„ï¼Œè€Œæœ€ç»ˆæ‰“åŒ…çš„distæ–‡ä»¶å¤¹ä¸­æ˜¯æ²¡æœ‰index.htmlæ–‡ä»¶çš„ã€‚ 
*   åœ¨è¿›è¡Œé¡¹ç›®éƒ¨ç½²çš„æ—¶ï¼Œå¿…ç„¶ä¹Ÿæ˜¯éœ€è¦æœ‰å¯¹åº”çš„å…¥å£æ–‡ä»¶index.html;
*   æ‰€ä»¥æˆ‘ä»¬ä¹Ÿéœ€è¦å¯¹index.htmlè¿›è¡Œæ‰“åŒ…å¤„ç†;

```bash
 npm install html-webpack-plugin -D
```

é…ç½®ï¼ˆå¯ä»¥åœ¨publicä¸­ä½¿ç”¨è‡ªå®šä¹‰æ¨¡æ¿ï¼‰

```js
const HtmlWebpackPlugin = require("html-webpack-plugin");


module.exports = {
  plugins: [
      new HtmlWebpackPlugin({
      	template: "./public/index.html",
      	title: "å“ˆå“ˆå“ˆå“ˆ"
      }),
  ],
};
```



### DefinePlugin

è¿™æ˜¯å› ä¸ºåœ¨ç¼–è¯‘templateæ¨¡å—æ—¶ï¼Œæœ‰ä¸€ä¸ªBASE_URL`<link rel="icon" href="<%= BASE_URL %>favicon.ico">`ä½†æ˜¯æˆ‘ä»¬å¹¶æ²¡æœ‰è®¾ç½®è¿‡è¿™ä¸ªå¸¸é‡å€¼ï¼Œæ‰€ä»¥ä¼šå‡ºç°æ²¡æœ‰å®šä¹‰çš„é”™è¯¯ï¼Œå¯ä»¥ä½¿ç”¨DefinePluginæ’ä»¶;

DefinePluginå…è®¸åœ¨ç¼–è¯‘æ—¶åˆ›å»ºé…ç½®çš„å…¨å±€å¸¸é‡ï¼Œæ˜¯ä¸€ä¸ªwebpackå†…ç½®çš„æ’ä»¶(ä¸éœ€è¦å•ç‹¬å®‰è£…)

```js
const { DefinePlugin } = require("webpack");

module.exports = {
  plugins: [
      new DefinePlugin({
      	BASE_URL: "'./'"
      }),
  ],
};
```





### CopyWebpackPlugin

åœ¨vueçš„æ‰“åŒ…è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæˆ‘ä»¬å°†ä¸€äº›æ–‡ä»¶æ”¾åˆ°publicçš„ç›®å½•ä¸‹ï¼Œé‚£ä¹ˆè¿™ä¸ªç›®å½•ä¼šè¢«å¤åˆ¶åˆ°distæ–‡ä»¶å¤¹ä¸­ã€‚ è¿™ä¸ªå¤åˆ¶çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨CopyWebpackPluginæ¥å®Œæˆ;

```bash
 npm install copy-webpack-plugin -D
```

é…ç½®CopyWebpackPluginï¼š

*   å¤åˆ¶çš„è§„åˆ™åœ¨patternsä¸­è®¾ç½®;
*   **from:**è®¾ç½®ä»å“ªä¸€ä¸ªæºä¸­å¼€å§‹å¤åˆ¶;
*   **to:**å¤åˆ¶åˆ°çš„ä½ç½®ï¼Œå¯ä»¥çœç•¥ï¼Œä¼šé»˜è®¤å¤åˆ¶åˆ°æ‰“åŒ…çš„ç›®å½•ä¸‹;
*   **globOptions:**è®¾ç½®ä¸€äº›é¢å¤–çš„é€‰é¡¹ï¼Œå…¶ä¸­å¯ä»¥ç¼–å†™éœ€è¦å¿½ç•¥çš„æ–‡ä»¶:
    *   .DS_Store:macç›®å½•ä¸‹å›è‡ªåŠ¨ç”Ÿæˆçš„ä¸€ä¸ªæ–‡ä»¶;
    *   index.html:ä¹Ÿä¸éœ€è¦å¤åˆ¶ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»é€šè¿‡HtmlWebpackPluginå®Œæˆäº†index.htmlçš„ç”Ÿæˆ;

```js
const CopyWebpackPlugin = require('copy-webpack-plugin');

module.exports = {
  plugins: [
      new CopyWebpackPlugin({
      patterns: [
        {
          from: "public",
          to: "./",
          globOptions: {
            ignore: [
              "**/index.html"
            ]
          }
        }
      ]
    })
  ],
};
```





## Modeé…ç½®

Modeé…ç½®é€‰é¡¹ï¼Œå¯ä»¥å‘ŠçŸ¥webpackä½¿ç”¨å“åº”æ¨¡å¼çš„å†…ç½®ä¼˜åŒ–: 

*   é»˜è®¤å€¼æ˜¯production(ä»€ä¹ˆéƒ½ä¸è®¾ç½®çš„æƒ…å†µä¸‹); 
*   å¯é€‰å€¼æœ‰:'none' | 'development' | 'production'

![image-20220116225529127](./images/image-20220116225529127.png)



```js
  // è®¾ç½®æ¨¡å¼
  // development å¼€å‘é˜¶æ®µ, ä¼šè®¾ç½®development
  // production å‡†å¤‡æ‰“åŒ…ä¸Šçº¿çš„æ—¶å€™, è®¾ç½®production
  mode: "development",
  // è®¾ç½®source-map, å»ºç«‹jsæ˜ å°„æ–‡ä»¶, æ–¹ä¾¿è°ƒè¯•ä»£ç å’Œé”™è¯¯
  devtool: "source-map",
```







## Babel

### ä»‹ç»

å¼€å‘ä¸­ï¼Œæˆ‘ä»¬æƒ³è¦ä½¿ç”¨ES6+çš„è¯­æ³•ï¼Œæƒ³è¦ä½¿ç”¨TypeScriptï¼Œå¼€å‘Reacté¡¹ç›®ï¼Œå®ƒä»¬éƒ½æ˜¯ç¦»ä¸å¼€Babelçš„ã€‚æ‰€ä»¥ï¼Œå­¦ä¹ Babelå¯¹äºæˆ‘ä»¬ç†è§£ä»£ç ä»ç¼–å†™åˆ°çº¿ä¸Šçš„è½¬å˜è¿‡ç¨‹è‡³å…³é‡è¦

Babelæ˜¯ä¸€ä¸ª**å·¥å…·é“¾**ï¼Œä¸»è¦ç”¨äºæ—§æµè§ˆå™¨æˆ–è€…ç¯å¢ƒä¸­å°†ECMAScript 2015+ä»£ç è½¬æ¢ä¸ºå‘åå…¼å®¹ç‰ˆæœ¬çš„ JavaScriptã€‚å¦‚**è¯­æ³•è½¬æ¢**ã€**æºä»£ç è½¬æ¢**ç­‰



### Babelå‘½ä»¤è¡Œä½¿ç”¨

babelæœ¬èº«å¯ä»¥ä½œä¸º**ä¸€ä¸ªç‹¬ç«‹çš„å·¥å…·**(å’Œpostcssä¸€æ ·)ï¼Œä¸å’Œwebpackç­‰æ„å»ºå·¥å…·é…ç½®æ¥å•ç‹¬ä½¿ç”¨

å¦‚æœæˆ‘ä»¬å¸Œæœ›åœ¨å‘½ä»¤è¡Œå°è¯•ä½¿ç”¨babelï¼Œéœ€è¦å®‰è£…å¦‚ä¸‹åº“

*   @babel/core:babelçš„æ ¸å¿ƒä»£ç ï¼Œå¿…é¡»å®‰è£…;
*   @babel/cli:å¯ä»¥è®©æˆ‘ä»¬åœ¨å‘½ä»¤è¡Œä½¿ç”¨babel;

```bash
 npm install @babel/cli @babel/core -D
```

ä½¿ç”¨babelæ¥å¤„ç†æˆ‘ä»¬çš„æºä»£ç :

*   src:æ˜¯æºæ–‡ä»¶çš„ç›®å½•;
*    --out-dir:æŒ‡å®šè¦è¾“å‡ºçš„æ–‡ä»¶å¤¹dist;

```bash
 npx babel src --out-dir dist
```





### æ’ä»¶çš„ä½¿ç”¨

æ¯”å¦‚æˆ‘ä»¬éœ€è¦è½¬æ¢ç®­å¤´å‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨**ç®­å¤´å‡½æ•°è½¬æ¢ç›¸å…³çš„æ’ä»¶**

```bash
 npm install @babel/plugin-transform-arrow-functions -D
 npx babel src --out-dir dist --plugins=@babel/plugin-transform-arrow-functions
```

æŸ¥çœ‹è½¬æ¢åçš„ç»“æœ:æˆ‘ä»¬ä¼šå‘ç° const å¹¶æ²¡æœ‰è½¬æˆ var

*   è¿™æ˜¯å› ä¸º plugin-transform-arrow-functionsï¼Œå¹¶æ²¡æœ‰æä¾›è¿™æ ·çš„åŠŸèƒ½;
*   æˆ‘ä»¬éœ€è¦ä½¿ç”¨ plugin-transform-block-scoping æ¥å®Œæˆè¿™æ ·çš„åŠŸèƒ½;

```bash
npm install @babel/plugin-transform-block-scoping -D
npx babel src --out-dir dist --plugins=@babel/plugin-transform-block-scoping ,@babel/plugin-transform-arrow-functions
```



### Babelçš„é¢„è®¾preset

ä½†æ˜¯å¦‚æœè¦è½¬æ¢çš„å†…å®¹è¿‡å¤šï¼Œä¸€ä¸ªä¸ªè®¾ç½®æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é¢„è®¾(preset)

å®‰è£…@babel/preset-envé¢„è®¾

```bash
 npm install @babel/preset-env -D
```

æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤

```bash
 npx babel src --out-dir dist --presets=@babel/preset-env
```



### Babelçš„åº•å±‚åŸç†

babelæ˜¯å¦‚ä½•åšåˆ°å°†æˆ‘ä»¬çš„**ä¸€æ®µä»£ç (ES6ã€TypeScriptã€React)**è½¬æˆ**å¦å¤–ä¸€æ®µä»£ç (ES5)**çš„å‘¢? 

*   ä»ä¸€ç§æºä»£ç (åŸç”Ÿè¯­è¨€)è½¬æ¢æˆå¦ä¸€ç§æºä»£ç (ç›®æ ‡è¯­è¨€)ï¼Œè¿™æ˜¯ä»€ä¹ˆçš„å·¥ä½œå‘¢?
*   å°±æ˜¯**ç¼–è¯‘å™¨**ï¼Œäº‹å®ä¸Šæˆ‘ä»¬å¯ä»¥å°†babelçœ‹æˆå°±æ˜¯ä¸€ä¸ªç¼–è¯‘å™¨ã€‚
*   Babelç¼–è¯‘å™¨çš„ä½œç”¨å°±æ˜¯å°†æˆ‘ä»¬çš„æºä»£ç ï¼Œè½¬æ¢æˆæµè§ˆå™¨å¯ä»¥ç›´æ¥è¯†åˆ«çš„å¦å¤–ä¸€æ®µæºä»£ç ;

**Babelä¹Ÿæ‹¥æœ‰ç¼–è¯‘å™¨çš„å·¥ä½œæµç¨‹:** 

*   è§£æé˜¶æ®µ(Parsing)
*   è½¬æ¢é˜¶æ®µ(Transformation) 
*   ç”Ÿæˆé˜¶æ®µ(Code Generation)

https://github.com/jamiebuilds/the-super-tiny-compiler



### Babelç¼–è¯‘å™¨æ‰§è¡ŒåŸç†

Babelçš„æ‰§è¡Œé˜¶æ®µ

![image-20220117003325292](./images/image-20220117003325292.png)

å½“ç„¶ï¼Œè¿™åªæ˜¯ä¸€ä¸ªç®€åŒ–ç‰ˆçš„ç¼–è¯‘å™¨å·¥å…·æµç¨‹ï¼Œåœ¨æ¯ä¸ªé˜¶æ®µåˆä¼šæœ‰è‡ªå·±å…·ä½“çš„å·¥ä½œ

![image-20220117003340937](./images/image-20220117003340937.png)



### babel-loader ğŸ”¥

åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šåœ¨æ„å»ºå·¥å…·ä¸­é€šè¿‡é…ç½®babelæ¥å¯¹å…¶è¿›è¡Œä½¿ç”¨çš„ï¼Œæ¯”å¦‚åœ¨webpackä¸­ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦å»å®‰è£…ç›¸å…³çš„ä¾èµ–ï¼Œå¦‚æœä¹‹å‰å·²ç»å®‰è£…äº†@babel/coreï¼Œé‚£ä¹ˆè¿™é‡Œä¸éœ€è¦å†æ¬¡å®‰è£…

```bash
 npm install babel-loader @babel/core -D
```

æˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ªè§„åˆ™ï¼Œåœ¨åŠ è½½jsæ–‡ä»¶æ—¶ï¼Œä½¿ç”¨æˆ‘ä»¬çš„babel

```js
{
    test: /\.js$/,
    loader: "babel-loader"
}
```

æˆ‘ä»¬å¿…é¡»æŒ‡å®šä½¿ç”¨çš„æ’ä»¶æ‰ä¼šç”Ÿæ•ˆ

```js
{
    test: /\.js$/,
        use: {
            loader: "babel-loader",
                options: {
                    plugins: [
                       "@babel/plugin-transform-arrow-functions",
                       "@babel/plugin-transform-block-scoping",
                    ]
                    
                }
        }
}
```



### babel-preset ğŸ”¥

å¦‚æœæˆ‘ä»¬ä¸€ä¸ªä¸ªå»å®‰è£…ä½¿ç”¨æ’ä»¶ï¼Œé‚£ä¹ˆéœ€è¦æ‰‹åŠ¨æ¥ç®¡ç†å¤§é‡çš„babelæ’ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç»™webpackæä¾›ä¸€ä¸ª presetï¼Œwebpackä¼šæ ¹æ®æˆ‘ä»¬çš„é¢„è®¾æ¥åŠ è½½å¯¹åº”çš„æ’ä»¶åˆ—è¡¨ï¼Œå¹¶ä¸”å°†å…¶ä¼ é€’ç»™babelã€‚

æ¯”å¦‚å¸¸è§çš„é¢„è®¾æœ‰ä¸‰ä¸ª: 

*   env

*   react 
*   TypeScript

å®‰è£…preset-env

```bash
 npm install @babel/preset-env
```

é…ç½®

```js
{
    test: /\.js$/,
        use: {
            loader: "babel-loader",
                options: {
                    // plugins: [
                    //   "@babel/plugin-transform-arrow-functions",
                    //   "@babel/plugin-transform-block-scoping",
                    // ]
                    presets: [
                        "@babel/preset-env"
                    ]
                }
        }
}
```





### Babelçš„é…ç½®æ–‡ä»¶

åƒä¹‹å‰ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥å°†babelçš„é…ç½®ä¿¡æ¯æ”¾åˆ°ä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ä¸­ï¼Œbabelç»™æˆ‘ä»¬æä¾›äº†ä¸¤ç§é…ç½®æ–‡ä»¶çš„ç¼–å†™:

*   babel.config.json(æˆ–è€….jsï¼Œ.cjsï¼Œ.mjs)æ–‡ä»¶;
*   .babelrc.json(æˆ–è€….babelrcï¼Œ.jsï¼Œ.cjsï¼Œ.mjs)æ–‡ä»¶;

å®ƒä»¬ä¸¤ä¸ªæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢?ç›®å‰å¾ˆå¤šçš„é¡¹ç›®éƒ½é‡‡ç”¨äº†å¤šåŒ…ç®¡ç†çš„æ–¹å¼(babelæœ¬èº«ã€element-plusã€umiç­‰); 

*   .babelrc.json:æ—©æœŸä½¿ç”¨è¾ƒå¤šçš„é…ç½®æ–¹å¼ï¼Œä½†æ˜¯å¯¹äºé…ç½®Monoreposé¡¹ç›®æ˜¯æ¯”è¾ƒéº»çƒ¦çš„;
*   **babel.config.json**(babel7):å¯ä»¥ç›´æ¥ä½œç”¨äºMonoreposé¡¹ç›®çš„å­åŒ…ï¼Œæ›´åŠ **æ¨è**;

babel.config.js

```js
module.exports = {
  presets: [
    "@babel/preset-env"
  ]
}
```

webpack.config.jså¯ä»¥ç²¾ç®€ä¸º

```js
{
    test: /\.js$/,
    loader: "babel-loader"
}
```







## Vue æ‰“åŒ… ğŸ”¥

### é—®é¢˜

å®‰è£…vue

```bash
npm install vue
```

ä¿®æ”¹element.js

```js
import { createApp } from 'vue';

createApp({
    template: '#my-app',
    data(){
        return {
            title: 'æ ‡é¢˜',
            content: 'å†…å®¹',
        }
    }
}).mount('#app');
```

ç”±äºvueæ˜¯jsæ–‡ä»¶ï¼Œæ‰€ä»¥æ‰“åŒ…æ˜¯æ­£å¸¸çš„ã€‚ä½†æ˜¯ç•Œé¢æ²¡æœ‰æ•ˆæœï¼Œä¸”æŠ¥å¦‚ä¸‹è­¦å‘Šï¼š

![image-20220117005531933](./images/image-20220117005531933.png)

ä¿®æ”¹ä¸ºå¦‚ä¸‹çš„å³å¯

```js
import { createApp } from 'vue/dist/vue.esm-bundler';
```

ä½†æ˜¯ä½¿ç”¨SFCæ—¶æ— éœ€æ”¹ä¸º`vue.esm-bundler`





### Vueæ‰“åŒ…åä¸åŒç‰ˆæœ¬è§£æ

*   **vue(.runtime).global(.prod).js**:
    *   pé€šè¿‡æµè§ˆå™¨ä¸­çš„ `<script src="...">` ç›´æ¥ä½¿ç”¨;
    *   æˆ‘ä»¬ä¹‹å‰é€šè¿‡CDNå¼•å…¥å’Œä¸‹è½½çš„Vueç‰ˆæœ¬å°±æ˜¯è¿™ä¸ªç‰ˆæœ¬; 
    *   ä¼šæš´éœ²ä¸€ä¸ªå…¨å±€çš„Vueæ¥ä½¿ç”¨;

*   **vue(.runtime).esm-browser(.prod).js**:
    *   ç”¨äºé€šè¿‡åŸç”Ÿ ES æ¨¡å—å¯¼å…¥ä½¿ç”¨ (åœ¨æµè§ˆå™¨ä¸­é€šè¿‡ `<script type="module">` æ¥ä½¿ç”¨)ã€‚

*    **vue(.runtime).esm-bundler.js**:
    *   ç”¨äº webpackï¼Œrollup å’Œ parcel ç­‰æ„å»ºå·¥å…·;
    *   **æ„å»ºå·¥å…·ä¸­é»˜è®¤**æ˜¯**vue.runtime.esm-bundler.js**;
    *   å¦‚æœæˆ‘ä»¬éœ€è¦è§£ææ¨¡æ¿templateï¼Œé‚£ä¹ˆéœ€è¦**æ‰‹åŠ¨æŒ‡å®švue.esm-bundler.js**;
*   **vue.cjs(.prod).js:
    *   æœåŠ¡å™¨ç«¯æ¸²æŸ“ä½¿ç”¨;
    *   é€šè¿‡require()åœ¨Node.jsä¸­ä½¿ç”¨;



### è¿è¡Œæ—¶+ç¼–è¯‘å™¨ vs ä»…è¿è¡Œæ—¶

åœ¨Vueçš„å¼€å‘è¿‡ç¨‹ä¸­æˆ‘ä»¬æœ‰**ä¸‰ç§æ–¹å¼**æ¥ç¼–å†™DOMå…ƒç´ :

*   æ–¹å¼ä¸€:templateæ¨¡æ¿çš„æ–¹å¼(ä¹‹å‰ç»å¸¸ä½¿ç”¨çš„æ–¹å¼);
*   æ–¹å¼äºŒ:renderå‡½æ•°çš„æ–¹å¼ï¼Œä½¿ç”¨hå‡½æ•°æ¥ç¼–å†™æ¸²æŸ“çš„å†…å®¹; 
*   æ–¹å¼ä¸‰:é€šè¿‡.vueæ–‡ä»¶ä¸­çš„templateæ¥ç¼–å†™æ¨¡æ¿;

**å®ƒä»¬çš„æ¨¡æ¿åˆ†åˆ«æ˜¯å¦‚ä½•å¤„ç†çš„å‘¢?**

*   æ–¹å¼äºŒä¸­çš„hå‡½æ•°å¯ä»¥ç›´æ¥è¿”å›ä¸€ä¸ª**è™šæ‹ŸèŠ‚ç‚¹**ï¼Œä¹Ÿå°±æ˜¯**VnodeèŠ‚ç‚¹**; 
*   æ–¹å¼ä¸€å’Œæ–¹å¼ä¸‰çš„templateéƒ½éœ€è¦æœ‰ç‰¹å®šçš„ä»£ç æ¥å¯¹å…¶è¿›è¡Œè§£æ:
    *   æ–¹å¼ä¸‰.vueæ–‡ä»¶ä¸­çš„templateå¯ä»¥é€šè¿‡åœ¨vue-loaderå¯¹å…¶è¿›è¡Œç¼–è¯‘å’Œå¤„ç†; 
    *   æ–¹å¼ä¸€ä¸­çš„templateæˆ‘ä»¬å¿…é¡»è¦é€šè¿‡æºç ä¸­ä¸€éƒ¨åˆ†ä»£ç æ¥è¿›è¡Œç¼–è¯‘;

æ‰€ä»¥ï¼ŒVueåœ¨è®©æˆ‘ä»¬é€‰æ‹©ç‰ˆæœ¬çš„æ—¶å€™åˆ†ä¸º **è¿è¡Œæ—¶+ç¼–è¯‘å™¨** vs **ä»…è¿è¡Œæ—¶

*   è¿è¡Œæ—¶+ç¼–è¯‘å™¨åŒ…å«äº†å¯¹templateæ¨¡æ¿çš„ç¼–è¯‘ä»£ç ï¼Œæ›´åŠ å®Œæ•´ï¼Œä½†æ˜¯ä¹Ÿæ›´å¤§ä¸€äº›; 
*   ä»…è¿è¡Œæ—¶æ²¡æœ‰åŒ…å«å¯¹templateç‰ˆæœ¬çš„ç¼–è¯‘ä»£ç ï¼Œç›¸å¯¹æ›´å°ä¸€äº›;





### VSCodeå¯¹SFCæ–‡ä»¶çš„æ”¯æŒ

çœŸå®å¼€å‘ä¸­å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬éƒ½æ˜¯ä½¿ç”¨SFC(**single-file components**)ï¼Œå³å•æ–‡ä»¶ç»„ä»¶æ–¹å¼

VSCodeå¯¹SFCçš„æ”¯æŒ:

*   æ’ä»¶ä¸€:**Vetur**ï¼Œä»Vue2å¼€å‘å°±ä¸€ç›´åœ¨ä½¿ç”¨çš„VSCodeæ”¯æŒVueçš„æ’ä»¶;
*   æ’ä»¶äºŒ:**Volar**ï¼Œå®˜æ–¹æ¨èçš„æ’ä»¶(åç»­ä¼šåŸºäºVolarå¼€å‘å®˜æ–¹çš„VSCodeæ’ä»¶); 









### App.vue æ‰“åŒ… ğŸ”¥

```bash
npm install vue-loader -D
npm install @vue/compiler-sfc -D
```

webpack.config.js

```js
{
    test: /\.vue$/,
    loader: "vue-loader"
}
```

è¿˜é…ç½®å¯¹åº”çš„Vueæ’ä»¶

```js
const { VueLoaderPlugin } = require('vue-loader/dist/index');

module.exports = {
  plugins: [
    new VueLoaderPlugin(),
  ],
};
```





## devServer ğŸ”¥

### éœ€æ±‚

ç›®å‰æˆ‘ä»¬å¼€å‘çš„ä»£ç ï¼Œä¸ºäº†è¿è¡Œéœ€è¦æœ‰ä¸¤ä¸ªæ“ä½œ

*   `npm run build`ç¼–è¯‘ç›¸å…³ä»£ç 
*   é€šè¿‡live serveræˆ–è€…ç›´æ¥é€šè¿‡æµè§ˆå™¨ï¼Œæ‰“å¼€index.htmlä»£ç ï¼ŒæŸ¥çœ‹æ•ˆæœ

è¿™ä¸ªè¿‡ç¨‹ç»å¸¸æ“ä½œä¼šå½±å“æˆ‘ä»¬çš„å¼€å‘æ•ˆç‡ï¼Œæˆ‘ä»¬å¸Œæœ›å¯ä»¥åšåˆ°ï¼Œå½“**æ–‡ä»¶å‘ç”Ÿå˜åŒ–**æ—¶ï¼Œå¯ä»¥**è‡ªåŠ¨çš„å®Œæˆç¼–è¯‘å’Œå±•ç¤º**ã€‚ä¸ºäº†å®Œæˆè‡ªåŠ¨ç¼–è¯‘ï¼Œwebpackæä¾›äº†å‡ ç§å¯é€‰çš„æ–¹å¼ï¼š

*   webpack watch mode
*   webpack-dev-serverï¼ˆå¸¸ç”¨ï¼‰
*   webpack-dev-middleware





### webpack watch

webpackç»™æˆ‘ä»¬æä¾›äº†**watchæ¨¡å¼**ã€‚åœ¨è¯¥æ¨¡å¼ä¸‹ï¼Œwebpackä¾èµ–å›¾ä¸­çš„æ‰€æœ‰æ–‡ä»¶ï¼Œåªè¦æœ‰ä¸€ä¸ª**å‘ç”Ÿäº†æ›´æ–°**ï¼Œé‚£ä¹ˆ**ä»£ç å°†è¢«é‡æ–°ç¼–è¯‘**ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨å»è¿è¡Œ npm run buildæŒ‡ä»¤äº†

**å¼€å¯watchä¸¤ç§æ–¹å¼**

*   åœ¨å¯¼å‡ºçš„é…ç½®ä¸­ï¼Œæ·»åŠ  `watch: true`ã€‚ä¿®æ”¹webpack.config.js

    ```js
    // mode: 'xxx',
    watch: true,
    ```

*   åœ¨å¯åŠ¨webpackçš„å‘½ä»¤ä¸­ï¼Œæ·»åŠ  `--watch`çš„æ ‡è¯†ã€‚ä¿®æ”¹package.json

    ```js
    "script": {
       "watch": "webpack --watch" 
    }
    ```

    





### webpack-dev-server ğŸ”¥

ä¸Šé¢çš„æ–¹å¼**å¯ä»¥ç›‘å¬åˆ°æ–‡ä»¶çš„å˜åŒ–**ï¼Œä½†æ˜¯äº‹å®ä¸Šå®ƒæœ¬èº«æ˜¯**æ²¡æœ‰è‡ªåŠ¨åˆ·æ–°æµè§ˆå™¨çš„åŠŸèƒ½**çš„ã€‚å½“ç„¶é€šè¿‡åœ¨VSCodeä¸­ä½¿ç”¨live-serveræ¥å®Œæˆè¿™æ ·çš„åŠŸèƒ½ã€‚åœ¨ä¸ä½¿ç”¨live-serverçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å…·å¤‡live reloading(å®æ—¶é‡æ–°åŠ è½½)çš„åŠŸèƒ½

#### å®‰è£…

*   **å®‰è£…webpack-dev-server**

    ```bash
     npm install webpack-dev-server -D
    ```

*   ä¿®æ”¹package.json

    ```json
    "script": {
       "serve": "webpack serve" 
    }
    ```

    æ‰§è¡Œ`npm run serve`å³å¯å®Œæˆ



#### contentBase é…ç½® ğŸ”¥

**ä¿®æ”¹webpack.config.jsé…ç½®æ–‡ä»¶**ï¼Œå‘ŠçŸ¥ devServerï¼Œä»ä»€ä¹ˆä½ç½®æŸ¥æ‰¾æ–‡ä»¶

```js
devServer: {
    contentBase: "./public",
}
```

è¿™é‡Œçš„æ–‡ä»¶æŒ‡çš„æ˜¯é¢å¤–çš„ï¼Œå¦‚favicon.ico æˆ–è€…å…¶ä»– x.mp4 ä¹‹ç±»çš„èµ„æºï¼Œä¸€èˆ¬æ”¾åœ¨ `/public`ä¸­

*   **æ‰“åŒ…**é˜¶æ®µï¼š**ä½¿ç”¨çš„æ˜¯`copyWepackPlugin`æ’ä»¶**ï¼Œæ¯æ¬¡æ‰“åŒ…å°†`/public`ä¸­æ–‡ä»¶å¤åˆ¶åˆ°`/build`ä¸­
*   **å¼€å‘**é˜¶æ®µï¼Œå¤åˆ¶æ–‡ä»¶æ¯”è¾ƒè€—è´¹æ€§èƒ½ï¼Œå¹¶ä¸” webpack-dev-server ä½¿ç”¨çš„æ˜¯å†…å­˜æ–¹å¼ï¼Œä¸é€‚åˆå¤åˆ¶è¿™äº›é™æ€èµ„æºã€‚æ‰€ä»¥åœ¨æ‰¾ä¸åˆ°èµ„æºæ—¶ï¼Œå°±ä¼šå»**é…ç½®çš„`contentBase`ä¸­æŸ¥æ‰¾**



#### hosté…ç½® ğŸ”¥

```js
devServer: {
    host: "0.0.0.0",
}
```

**hostè®¾ç½®ä¸»æœºåœ°å€**:

*   é»˜è®¤å€¼æ˜¯`localhost`; 
*   å¦‚æœå¸Œæœ›**å…¶ä»–åœ°æ–¹ä¹Ÿå¯ä»¥è®¿é—®**ï¼Œå¯ä»¥è®¾ç½®ä¸º`0.0.0.0`;

**localhost å’Œ 0.0.0.0 çš„åŒºåˆ«**

*   localhost:æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåŸŸåï¼Œé€šå¸¸æƒ…å†µä¸‹ä¼šè¢«è§£ææˆ127.0.0.1;
*   127.0.0.1:å›ç¯åœ°å€(Loop Back Address)ï¼Œè¡¨è¾¾çš„æ„æ€å…¶å®æ˜¯æˆ‘ä»¬ä¸»æœºè‡ªå·±å‘å‡ºå»çš„åŒ…ï¼Œç›´æ¥è¢«è‡ªå·±æ¥æ”¶;
    *   æ­£å¸¸çš„æ•°æ®åº“åŒ…ç»å¸¸ åº”ç”¨å±‚ - ä¼ è¾“å±‚ - ç½‘ç»œå±‚ - æ•°æ®é“¾è·¯å±‚ - ç‰©ç†å±‚ ;
    *   è€Œå›ç¯åœ°å€ï¼Œæ˜¯åœ¨ç½‘ç»œå±‚ç›´æ¥å°±è¢«è·å–åˆ°äº†ï¼Œæ˜¯ä¸ä¼šç»å¸¸æ•°æ®é“¾è·¯å±‚å’Œç‰©ç†å±‚çš„; uÌˆ æ¯”å¦‚æˆ‘ä»¬ç›‘å¬ 127.0.0.1æ—¶ï¼Œåœ¨åŒä¸€ä¸ªç½‘æ®µä¸‹çš„ä¸»æœºä¸­ï¼Œé€šè¿‡ipåœ°å€æ˜¯ä¸èƒ½è®¿é—®çš„



#### portã€openã€compress é…ç½® ğŸ”¥

*   **portè®¾ç½®ç›‘å¬çš„ç«¯å£ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯8080**

*   **openæ˜¯å¦æ‰“å¼€æµè§ˆå™¨**

    é»˜è®¤å€¼æ˜¯falseï¼Œè®¾ç½®ä¸ºtrueä¼šæ‰“å¼€æµè§ˆå™¨; ä¹Ÿå¯ä»¥è®¾ç½®ä¸ºç±»ä¼¼äº Google Chromeç­‰å€¼

*   **compressæ˜¯å¦ä¸ºé™æ€æ–‡ä»¶å¼€å¯gzip compression**

    é»˜è®¤å€¼æ˜¯falseï¼Œå¯ä»¥è®¾ç½®ä¸ºtrueã€‚ä¸€èˆ¬å¯¹jsè¿›è¡Œå‹ç¼©ï¼



#### proxy é…ç½® ğŸ”¥

é¦–å…ˆè¦æ˜ç¡®ï¼Œè·¨åŸŸæ˜¯æµè§ˆå™¨çš„å®‰å…¨ç­–ç•¥ï¼æœåŠ¡å™¨ä¹‹é—´è®¿é—®æ²¡æœ‰è·¨åŸŸé—®é¢˜ã€‚proxyå°±æ˜¯æ ¹æ®è¿™ä¸ªåŸç†æ¥è§£å†³å¼€å‘é˜¶æ®µè·¨åŸŸé—®é¢˜ï¼

å¦‚ï¼Œ8000è®¿é—®8888çš„api

```js
devServer: {
	proxy: {
      "/api": {
        target: "http://localhost:8888",
        pathRewrite: {
          "^/api": ""
        },
        secure: false,
        changeOrigin: true
      }
    } 
}
```

**proxyæ˜¯æˆ‘ä»¬å¼€å‘ï¼ˆç”Ÿäº§ä¸­ä¸ ç”¨è¿™ä¸ªï¼ï¼‰ä¸­éå¸¸å¸¸ç”¨çš„ä¸€ä¸ªé…ç½®é€‰é¡¹ï¼Œå®ƒçš„ç›®çš„è®¾ç½®ä»£ç†æ¥è§£å†³è·¨åŸŸè®¿é—®çš„é—®é¢˜:**

*   æ¯”å¦‚æˆ‘ä»¬çš„ä¸€ä¸ªapiè¯·æ±‚æ˜¯ http://localhost:8888ï¼Œä½†æ˜¯æœ¬åœ°å¯åŠ¨æœåŠ¡å™¨çš„åŸŸåæ˜¯ http://localhost:8000ï¼Œè¿™ ä¸ªæ—¶å€™å‘é€ç½‘ç»œè¯·æ±‚å°±ä¼šå‡ºç°è·¨åŸŸçš„é—®é¢˜;

*   é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°†è¯·æ±‚å…ˆå‘é€åˆ°ä¸€ä¸ªä»£ç†æœåŠ¡å™¨ï¼Œä»£ç†æœåŠ¡å™¨å’ŒAPIæœåŠ¡å™¨æ²¡æœ‰è·¨åŸŸçš„é—®é¢˜ï¼Œå°±å¯ä»¥è§£å†³æˆ‘ä»¬çš„è·¨åŸŸé—®é¢˜äº†;

**è¿›è¡Œå¦‚ä¸‹çš„è®¾ç½®**

*   **target:**è¡¨ç¤ºçš„æ˜¯ä»£ç†åˆ°çš„ç›®æ ‡åœ°å€ï¼Œæ¯”å¦‚ `/api-hy/moment`ä¼šè¢«ä»£ç†åˆ° http://localhost:8888/api-hy/moment;
*   **pathRewrite:**é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„ /api-hy ä¹Ÿä¼šè¢«å†™å…¥åˆ°URLä¸­ï¼Œå¦‚æœå¸Œæœ›åˆ é™¤ï¼Œå¯ä»¥ä½¿ç”¨pathRewrite; 
*   **secure:**é»˜è®¤æƒ…å†µä¸‹ä¸æ¥æ”¶è½¬å‘åˆ°httpsçš„æœåŠ¡å™¨ä¸Šï¼Œå¦‚æœå¸Œæœ›æ”¯æŒï¼Œå¯ä»¥è®¾ç½®ä¸ºfalse; å¼€å‘é˜¶æ®µå¯ä»¥ç½®ä¸ºfalse
*   **changeOrigin:**å®ƒè¡¨ç¤ºæ˜¯å¦æ›´æ–°ä»£ç†åè¯·æ±‚çš„headersä¸­hoståœ°å€ï¼ˆå°†targeté…ç½®å†™å…¥headerï¼‰ã€‚





#### historyApiFallback é…ç½®

å’Œè·¯ç”±æœ‰å…³ï¼

**historyApiFallback**æ˜¯å¼€å‘ä¸­ä¸€ä¸ªéå¸¸å¸¸è§çš„å±æ€§ï¼Œå®ƒä¸»è¦çš„ä½œç”¨æ˜¯è§£å†³SPAé¡µé¢åœ¨è·¯ç”±è·³è½¬ä¹‹åï¼Œè¿›è¡Œé¡µé¢åˆ·æ–°æ—¶ï¼Œè¿”å›404çš„é”™è¯¯ã€‚

booleanå€¼ï¼š

*   é»˜è®¤æ˜¯false
*   å¦‚æœè®¾ç½®ä¸ºtrueï¼Œé‚£ä¹ˆåœ¨åˆ·æ–°æ—¶ï¼Œè¿”å›404é”™è¯¯æ—¶ï¼Œä¼šè‡ªåŠ¨è¿”å› index.html çš„å†…å®¹

objectç±»å‹çš„å€¼ï¼Œå¯ä»¥é…ç½®rewriteså±æ€§(äº†è§£)ï¼š

*   å¯ä»¥é…ç½®fromæ¥åŒ¹é…è·¯å¾„ï¼Œå†³å®šè¦è·³è½¬åˆ°å“ªä¸€ä¸ªé¡µé¢

äº‹å®ä¸ŠdevServerä¸­å®ç°historyApiFallbackåŠŸèƒ½æ˜¯é€šè¿‡[connect-history-api-fallbackåº“](https://github.com/bripkens/connect-history-api-fallback)çš„



### HMR æ¨¡å—çƒ­æ›¿æ¢ ğŸ”¥

#### ä»‹ç»

HMRçš„å…¨ç§°æ˜¯Hot Module Replacementï¼Œç¿»è¯‘ä¸ºæ¨¡å—çƒ­æ›¿æ¢ã€‚æŒ‡åœ¨ **åº”ç”¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­**ï¼Œ**æ›¿æ¢ã€æ·»åŠ ã€åˆ é™¤**æ¨¡å—ï¼Œè€Œ**æ— éœ€é‡æ–°åˆ·æ–°**æ•´ä¸ªé¡µé¢ã€‚

HMRé€šè¿‡å¦‚ä¸‹å‡ ç§æ–¹å¼ï¼Œæ¥æé«˜å¼€å‘çš„é€Ÿåº¦ï¼š

*   **ä¸é‡æ–°åŠ è½½æ•´ä¸ªé¡µé¢**ï¼Œè¿™æ ·å¯ä»¥**ä¿ç•™**æŸäº›åº”ç”¨ç¨‹åºçš„**çŠ¶æ€**ä¸ä¸¢å¤±ã€‚å¦‚**è®¡æ•°å™¨**
*   **åªæ›´æ–°éœ€è¦å˜åŒ–çš„å†…å®¹**ï¼ŒèŠ‚çœå¼€å‘çš„æ—¶é—´
*   ä¿®æ”¹äº†cssã€jsæºä»£ç ï¼Œä¼šç«‹å³åœ¨æµè§ˆå™¨æ›´æ–°ï¼Œç›¸å½“äºç›´æ¥åœ¨æµè§ˆå™¨çš„devtoolsä¸­ç›´æ¥ä¿®æ”¹æ ·å¼

é»˜è®¤æƒ…å†µä¸‹ï¼Œ**webpack-dev-serverå·²ç»æ”¯æŒHMR**ï¼Œæˆ‘ä»¬åª**éœ€è¦å¼€å¯**å³å¯ã€‚åœ¨ä¸å¼€å¯HMRçš„æƒ…å†µä¸‹ï¼Œå½“æˆ‘ä»¬ä¿®æ”¹äº†æºä»£ç ä¹‹åï¼Œæ•´ä¸ªé¡µé¢ä¼šè‡ªåŠ¨åˆ·æ–°ï¼Œä½¿ç”¨çš„æ˜¯live reloading



#### hot é…ç½® ğŸ”¥

**ä¿®æ”¹webpack.config.jsé…ç½®æ–‡ä»¶**

```js
target: 'web', // è¿™ä¸ªä¸é…ç½®æœ‰æ—¶ä¼šå‡ºé—®é¢˜ï¼
devServer: {
    hot: true,
}
```

æµè§ˆå™¨å¯ä»¥çœ‹åˆ°å¦‚ä¸‹æ•ˆæœ

![image-20220128001224736](./images/image-20220128001224736.png)

ä½†æ˜¯ä½ ä¼šå‘ç°ï¼Œ**å½“æˆ‘ä»¬ä¿®æ”¹äº†æŸä¸€ä¸ªæ¨¡å—çš„ä»£ç æ—¶ï¼Œä¾ç„¶æ˜¯åˆ·æ–°çš„æ•´ä¸ªé¡µé¢**ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬éœ€è¦å»**æŒ‡å®šå“ªäº›æ¨¡å—å‘ç”Ÿæ›´æ–°**æ—¶ï¼Œè¿›è¡ŒHMRã€‚**å¯¼å…¥æ–‡ä»¶çš„æ–¹å¼è¿˜éœ€è¦æ·»åŠ HMRæ–¹å¼**ï¼ï¼ï¼å¦‚main.jsä¸­ï¼š

```js
import './js/element'; // æ—§æ–¹å¼ï¼Œä¸èƒ½åˆ 

// HMR æ–¹å¼
if(module.hot) {
 	module.hot.accept('./js/element.js', () => {
        console.log('element HMR');
    }
}
```

ä¸Šé¢æ–¹å¼å¤ªéº»çƒ¦äº†ï¼ï¼ï¼



#### æ¡†æ¶çš„HMR ğŸ”¥

åœ¨å¼€å‘å…¶ä»–é¡¹ç›®æ—¶ï¼Œ**æˆ‘ä»¬æ˜¯å¦éœ€è¦ç»å¸¸æ‰‹åŠ¨å»å†™å…¥ module.hot.accpetç›¸å…³çš„APIå‘¢**?æ¯”å¦‚å¼€å‘Vueã€Reacté¡¹ç›®ï¼Œæˆ‘ä»¬ä¿®æ”¹äº†ç»„ä»¶ï¼Œå¸Œæœ›è¿›è¡Œçƒ­æ›´æ–°ï¼Œè¿™ä¸ªæ—¶å€™åº”è¯¥å¦‚ä½•å»æ“ä½œå‘¢? äº‹å®ä¸Šç¤¾åŒºå·²ç»é’ˆå¯¹è¿™äº›æœ‰å¾ˆæˆç†Ÿçš„è§£å†³æ–¹æ¡ˆäº†;

*   æ¯”å¦‚vueå¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨vue-loaderï¼Œæ­¤loader**æ”¯æŒvueç»„ä»¶çš„HMR**ï¼Œæä¾›å¼€ç®±å³ç”¨çš„ä½“éªŒ;

*   æ¯”å¦‚reactå¼€å‘ä¸­ï¼Œæœ‰React Hot Loaderï¼Œå®æ—¶è°ƒæ•´reactç»„ä»¶(ç›®å‰Reactå®˜æ–¹å·²ç»å¼ƒç”¨äº†ï¼Œæ”¹æˆä½¿ç”¨react-refresh);

æ³¨æ„ï¼šæœ‰æ—¶TSæ–‡ä»¶çš„HMRä¹Ÿéœ€è¦æ‰‹åŠ¨é…ç½®ï¼ä½¿ç”¨vbené¡¹ç›®æ—¶é‡åˆ°è¯¥é—®é¢˜ï¼





#### HMR åŸç† ğŸ”¥

webpack-dev-serverä¼šåˆ›å»ºä¸¤ä¸ªæœåŠ¡:æä¾›é™æ€èµ„æºçš„æœåŠ¡(**express**)å’ŒSocketæœåŠ¡(**net.Socket**); 

*   express serverè´Ÿè´£ç›´æ¥æä¾›é™æ€èµ„æºçš„æœåŠ¡(æ‰“åŒ…åçš„èµ„æºç›´æ¥è¢«æµè§ˆå™¨è¯·æ±‚å’Œè§£æ);
*   **HMR Socket Serverï¼Œæ˜¯ä¸€ä¸ªsocketçš„é•¿è¿æ¥**
    *   é•¿è¿æ¥æœ‰ä¸€ä¸ªæœ€å¥½çš„å¥½å¤„æ˜¯**å»ºç«‹è¿æ¥ååŒæ–¹å¯ä»¥é€šä¿¡**(æœåŠ¡å™¨å¯ä»¥ç›´æ¥å‘é€æ–‡ä»¶åˆ°å®¢æˆ·ç«¯); 
    *   å½“æœåŠ¡å™¨**ç›‘å¬åˆ°å¯¹åº”çš„æ¨¡å—å‘ç”Ÿå˜åŒ–æ—¶**ï¼Œä¼šç”Ÿæˆ**ä¸¤ä¸ªæ–‡ä»¶.json(manifestæ–‡ä»¶)å’Œ.jsæ–‡ä»¶(update chunk)**; 
    *   é€šè¿‡é•¿è¿æ¥ï¼Œå¯ä»¥**ç›´æ¥å°†è¿™ä¸¤ä¸ªæ–‡ä»¶ä¸»åŠ¨å‘é€ç»™å®¢æˆ·ç«¯(æµè§ˆå™¨)**;
    *   **æµè§ˆå™¨æ‹¿åˆ°ä¸¤ä¸ªæ–°çš„æ–‡ä»¶å**ï¼Œé€šè¿‡HMR runtimeæœºåˆ¶ï¼Œ**åŠ è½½**è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”é’ˆå¯¹ä¿®æ”¹çš„æ¨¡å—è¿›è¡Œæ›´æ–°;

![image-20220128002445417](./images/image-20220128002445417.png)







## resolve æ¨¡å—è§£æé…ç½®

### ä»‹ç»

resolveç”¨äºè®¾ç½®æ¨¡å—å¦‚ä½•è¢«è§£æ:

*   åœ¨å¼€å‘ä¸­æˆ‘ä»¬ä¼šæœ‰å„ç§å„æ ·çš„æ¨¡å—ä¾èµ–ï¼Œè¿™äº›æ¨¡å—å¯èƒ½æ¥è‡ªäºè‡ªå·±ç¼–å†™çš„ä»£ç ï¼Œä¹Ÿå¯èƒ½æ¥è‡ªç¬¬ä¸‰æ–¹åº“; 
*   resolveå¯ä»¥å¸®åŠ©webpackä»æ¯ä¸ª require/import è¯­å¥ä¸­ï¼Œæ‰¾åˆ°éœ€è¦å¼•å…¥åˆ°åˆé€‚çš„æ¨¡å—ä»£ç ;
*   webpack ä½¿ç”¨ [enhanced-resolve](https://github.com/webpack/enhanced-resolve) æ¥è§£ææ–‡ä»¶è·¯å¾„;



### è·¯å¾„

**webpackèƒ½è§£æä¸‰ç§æ–‡ä»¶è·¯å¾„**

*   ç»å¯¹è·¯å¾„ï¼šç”±äºå·²ç»è·å¾—æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œå› æ­¤ä¸éœ€è¦å†åšè¿›ä¸€æ­¥è§£æ
*   ç›¸å¯¹è·¯å¾„ï¼š
    *   åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨ import æˆ– require çš„èµ„æºæ–‡ä»¶æ‰€å¤„çš„ç›®å½•ï¼Œè¢«è®¤ä¸ºæ˜¯ä¸Šä¸‹æ–‡ç›®å½•
    *   åœ¨ import/require ä¸­ç»™å®šçš„ç›¸å¯¹è·¯å¾„ï¼Œä¼šæ‹¼æ¥æ­¤ä¸Šä¸‹æ–‡è·¯å¾„ï¼Œæ¥ç”Ÿæˆæ¨¡å—çš„ç»å¯¹è·¯å¾„
*   **æ¨¡å—è·¯å¾„**ï¼ˆå¦‚ `import { createApp } from 'vue';`ï¼š
    *   åœ¨ resolve.modulesä¸­æŒ‡å®šçš„æ‰€æœ‰ç›®å½•æ£€ç´¢æ¨¡å—ã€‚é»˜è®¤å€¼æ˜¯ ['node_modules']ï¼Œæ‰€ä»¥é»˜è®¤ä¼šä»node_modulesä¸­æŸ¥æ‰¾æ–‡ä»¶
    *   æˆ‘ä»¬å¯ä»¥é€šè¿‡**è®¾ç½®åˆ«å**çš„æ–¹å¼æ¥æ›¿æ¢åˆè¯†æ¨¡å—è·¯å¾„ï¼Œå…·ä½“åé¢è®²è§£**alias**çš„é…ç½®



### æ–‡ä»¶ï¼Ÿæ–‡ä»¶å¤¹ï¼Ÿ

*   å¦‚æœæ˜¯ä¸€ä¸ªæ–‡ä»¶

    *   å¦‚æœæ–‡ä»¶å…·æœ‰æ‰©å±•åï¼Œåˆ™ç›´æ¥æ‰“åŒ…æ–‡ä»¶
    *   å¦åˆ™ï¼Œå°†ä½¿ç”¨ resolve.extensionsé€‰é¡¹ä½œä¸ºæ–‡ä»¶æ‰©å±•åè§£æï¼ˆä¾æ¬¡åŒ¹é…æ‰©å±•æŸ¥è¯¢æ–‡ä»¶ï¼‰

*   å¦‚æœæ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹

    ä¼š**åœ¨æ–‡ä»¶å¤¹ä¸­**æ ¹æ® resolve.mainFilesé…ç½®é€‰é¡¹ä¸­æŒ‡å®šçš„**æ–‡ä»¶é¡ºåº**æŸ¥æ‰¾

    *   resolve.mainFilesçš„é»˜è®¤å€¼æ˜¯ `['index']`
    *   å†æ ¹æ® resolve.extensionsæ¥è§£ææ‰©å±•å

    æ‰€ä»¥ä¸€èˆ¬æŸ¥æ‰¾åˆ°indexæ–‡ä»¶



### extensionså’Œaliasé…ç½®

extensionsæ˜¯è§£æåˆ°æ–‡ä»¶æ—¶è‡ªåŠ¨æ·»åŠ æ‰©å±•å:

*   é»˜è®¤å€¼æ˜¯ ['.wasm', '.mjs', '.js', '.json'];
*   æ‰€ä»¥å¦‚æœæˆ‘ä»¬ä»£ç ä¸­æƒ³è¦æ·»åŠ åŠ è½½ .vue æˆ–è€… jsx æˆ–è€… ts ç­‰æ–‡ä»¶æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»è‡ªå·±å†™ä¸Šæ‰©å±•å;

å¦ä¸€ä¸ªéå¸¸å¥½ç”¨çš„åŠŸèƒ½æ˜¯é…ç½®åˆ«åalias: 

*   ç‰¹åˆ«æ˜¯å½“æˆ‘ä»¬é¡¹ç›®çš„ç›®å½•ç»“æ„æ¯”è¾ƒæ·±çš„æ—¶å€™ï¼Œæˆ–è€…ä¸€ä¸ªæ–‡ä»¶çš„è·¯å¾„å¯èƒ½éœ€è¦ ../../../è¿™ç§è·¯å¾„ç‰‡æ®µ; 
*   æˆ‘ä»¬å¯ä»¥ç»™æŸäº›å¸¸è§çš„è·¯å¾„èµ·ä¸€ä¸ªåˆ«å;



### é…ç½® ğŸ”¥

ä¿®æ”¹webpack.config.jsé…ç½®æ–‡ä»¶

```js
resolve: {
    extensions: [".js", ".json", ".mjs", ".vue", ".ts", ".jsx", ".tsx"],
    alias: {
      "@": path.resolve(__dirname, "./src"),
      "js": path.resolve(__dirname, "./src/js")
    }
  },
```





## åˆ†ç¦»å¼€å‘ç”Ÿäº§ç¯å¢ƒ ğŸ”¥

ç›®å‰æˆ‘ä»¬æ‰€æœ‰çš„webpacké…ç½®ä¿¡æ¯éƒ½æ˜¯æ”¾åˆ°ä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­çš„:webpack.config.js

*   å½“é…ç½®è¶Šæ¥è¶Šå¤šæ—¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä¼šå˜å¾—è¶Šæ¥è¶Šä¸å®¹æ˜“ç»´æŠ¤;

*   å¹¶ä¸”æŸäº›é…ç½®æ˜¯åœ¨å¼€å‘ç¯å¢ƒéœ€è¦ä½¿ç”¨çš„ï¼ŒæŸäº›é…ç½®æ˜¯åœ¨ç”Ÿæˆç¯å¢ƒéœ€è¦ä½¿ç”¨çš„ï¼Œå½“ç„¶æŸäº›é…ç½®æ˜¯åœ¨å¼€å‘å’Œç”Ÿæˆç¯ å¢ƒéƒ½ä¼šä½¿ç”¨çš„;

*   æ‰€ä»¥ï¼Œæˆ‘ä»¬æœ€å¥½å¯¹é…ç½®è¿›è¡Œåˆ’åˆ†ï¼Œæ–¹ä¾¿æˆ‘ä»¬ç»´æŠ¤å’Œç®¡ç†;

é‚£ä¹ˆï¼Œåœ¨å¯åŠ¨æ—¶å¦‚ä½•å¯ä»¥åŒºåˆ†ä¸åŒçš„é…ç½®å‘¢?

*   æ–¹æ¡ˆä¸€ï¼šç¼–å†™ä¸¤ä¸ªä¸åŒçš„é…ç½®æ–‡ä»¶ï¼Œå¼€å‘å’Œç”Ÿæˆæ—¶ï¼Œåˆ†åˆ«åŠ è½½ä¸åŒçš„é…ç½®æ–‡ä»¶å³å¯; 

*   æ–¹å¼äºŒï¼šä½¿ç”¨ç›¸åŒçš„ä¸€ä¸ªå…¥å£é…ç½®æ–‡ä»¶ï¼Œé€šè¿‡è®¾ç½®å‚æ•°æ¥åŒºåˆ†å®ƒä»¬;

    ä¿®æ”¹package.json

    ```json
    {
        "scripts": {
            "build": "webpack --config ./config/webpack.prod.config.js",
            "serve": "webpack serve --config ./config/webpack.dev.config.js"
        },   
    }
    ```

    å®‰è£…`merge`

    ```bash
    npm install webpack-merge -D
    ```

é…ç½®æ–‡ä»¶

/config/webpack.comm.config.js

```js
const path = require("path");
const HtmlWebpackPlugin = require("html-webpack-plugin");
const { DefinePlugin } = require("webpack");
const { VueLoaderPlugin } = require('vue-loader/dist/index');

module.exports = {
  target: "web",
  entry: "./src/main.js",
  output: {
    path: path.resolve(__dirname, "../build"),
    filename: "js/bundle.js",
  },
  resolve: {
    extensions: [".js", ".json", ".mjs", ".vue", ".ts", ".jsx", ".tsx"],
    alias: {
      "@": path.resolve(__dirname, "../src"),
      "js": path.resolve(__dirname, "../src/js")
    }
  },
  module: {
    rules: [
      {
        test: /\.css$/,
        use: ["style-loader", "css-loader", "postcss-loader"],
      },
      {
        test: /\.less$/,
        use: ["style-loader", "css-loader", "less-loader"],
      },
      // },
      {
        test: /\.(jpe?g|png|gif|svg)$/,
        type: "asset",
        generator: {
          filename: "img/[name]_[hash:6][ext]",
        },
        parser: {
          dataUrlCondition: {
            maxSize: 10 * 1024,
          },
        },
      },
      {
        test: /\.(eot|ttf|woff2?)$/,
        type: "asset/resource",
        generator: {
          filename: "font/[name]_[hash:6][ext]",
        },
      },
      {
        test: /\.js$/,
        loader: "babel-loader"
      },
      {
        test: /\.vue$/,
        loader: "vue-loader"
      }
    ],
  },
  plugins: [
    new HtmlWebpackPlugin({
      template: "./public/index.html",
      title: "å“ˆå“ˆå“ˆå“ˆ"
    }),
    new DefinePlugin({
      BASE_URL: "'./'",
      __VUE_OPTIONS_API__: true,
      __VUE_PROD_DEVTOOLS__: false
    }),
    new VueLoaderPlugin()
  ],
};
```



/config/webpack.dev.config.js

```js
const { merge } = require('webpack-merge');

const commonConfig = require('./webpack.comm.config');

module.exports = merge(commonConfig, {
  mode: "development",
  devtool: "source-map",
  devServer: {
    contentBase: "./public",
    hot: true,
    // host: "0.0.0.0",
    port: 7777,
    open: true,
    // compress: true,
    proxy: {
      "/api": {
        target: "http://localhost:8888",
        pathRewrite: {
          "^/api": ""
        },
        secure: false,
        changeOrigin: true
      }
    }
  },
})
```



/config/webpack.prod.config.js

```js
const { CleanWebpackPlugin } = require("clean-webpack-plugin");
const CopyWebpackPlugin = require('copy-webpack-plugin');
const {merge} = require('webpack-merge');

const commonConfig = require('./webpack.comm.config');

module.exports = merge(commonConfig, {
  mode: "production",
  plugins: [
    new CleanWebpackPlugin(),
    new CopyWebpackPlugin({
      patterns: [
        {
          from: "./public",
          globOptions: {
            ignore: [
              "**/index.html"
            ]
          }
        }
      ]
    }),
  ]
})
```

