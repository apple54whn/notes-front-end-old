---
title: VueRouter
date: 2022-02-08 18:29:59
permalink: /pages/1c8fc2/
categories:
  - x
  - VueRouter
tags:
  - 
---
title: VueRouter
date: 2022-02-08 18:29:59
permalink: /pages/23d4f4/
categories:

  - x
  - VueRouter
tags:
  - 

# VueRouter

## è®¤è¯†

ç›®å‰å‰ç«¯æµè¡Œçš„ä¸‰å¤§æ¡†æ¶, éƒ½æœ‰è‡ªå·±çš„è·¯ç”±å®ç°:

* Angularçš„ngRouter
* Reactçš„ReactRouter
* Vueçš„vue-router

vue-routeræ˜¯åŸºäº**è·¯ç”±**å’Œ**ç»„ä»¶**çš„

* è·¯ç”±ç”¨äºè®¾å®šè®¿é—®è·¯å¾„, å°†**è·¯å¾„å’Œç»„ä»¶æ˜ å°„**èµ·æ¥. 
* åœ¨vue-routerçš„å•é¡µé¢åº”ç”¨ä¸­, é¡µé¢çš„**è·¯å¾„çš„æ”¹å˜**å°±æ˜¯**ç»„ä»¶çš„åˆ‡æ¢**.



## å®‰è£…

ç›®å‰Vueè·¯ç”±æœ€æ–°çš„ç‰ˆæœ¬æ˜¯4.xç‰ˆæœ¬

```bash
npm install vue-router@4
```



## æ ‡ç­¾è·¯ç”±ä½¿ç”¨æ­¥éª¤

### åˆ›å»ºè·¯ç”±ç»„ä»¶çš„ç»„ä»¶

/src/pages/Home.vue

```vue
<template>
  <h2>Home</h2>
</template>

<script setup></script>

<style lang="scss" scoped></style>
```

/src/pages/About.vue

```vue
<template>
  <h2>About</h2>
</template>

<script setup></script>

<style lang="scss" scoped></style>
```

### é…ç½®è·¯ç”±æ˜ å°„

ç»„ä»¶å’Œè·¯å¾„**æ˜ å°„å…³ç³»çš„routesæ•°ç»„**; 

é€šè¿‡createRouteråˆ›å»ºè·¯ç”±å¯¹è±¡ï¼Œå¹¶ä¸”ä¼ å…¥routeså’Œhistoryæ¨¡å¼; 

/src/router/index.js

```js
import { createRouter, createWebHistory } from 'vue-router'
import Home from '../views/Home.vue'
import About from '../views/About.vue'

const routes = [
  {
    path: '/',
    redirect: '/home',
  },
  {
    path: '/home',
    component: Home,
  },
  {
    path: '/about',
    component: About,
  },
]

const router = createRouter({
  history: createWebHistory(),
  routes,
})

export default router
```

/src/main.js

```js
import { createApp } from 'vue'
import App from './App.vue'
import router from './router'

createApp(App).use(router).mount('#app')
```



### `<router-link>`å’Œ`<router-view>`

é€šè¿‡`<router-link>`å’Œ`<router-view>`ï¼Œä½¿ç”¨è·¯ç”±: 

/src/App.vue

```vue
<template>
  <div>
    <router-link to="/home">Home</router-link> |
    <router-link to="/about">About</router-link>
    <router-view />
  </div>
</template>

<style>
.router-link-active {
  color: red;
}
</style>
```





### router-link é…ç½®

* `to`å±æ€§:

  æ˜¯ä¸€ä¸ª**å­—ç¬¦ä¸²**ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ª**å¯¹è±¡**

* `replace`å±æ€§:

  è®¾ç½® replace å±æ€§çš„è¯ï¼Œå½“ç‚¹å‡»æ—¶ï¼Œä¼šè°ƒç”¨ router.replace()ï¼Œè€Œä¸æ˜¯ router.push();

* `active-class`å±æ€§:

  è®¾ç½®æ¿€æ´»aå…ƒç´ ååº”ç”¨çš„classï¼Œé»˜è®¤æ˜¯router-link-active

* `exact-active-class`å±æ€§:

  **åµŒå¥—è·¯ç”±**ï¼Œ**é“¾æ¥ç²¾å‡†æ¿€æ´»**æ—¶ï¼Œåº”ç”¨äºæ¸²æŸ“çš„ `<a>` çš„ classï¼Œé»˜è®¤æ˜¯router-link-exact-active;



### router-link å’Œ router-view çš„ v-slot ğŸ”¥

åœ¨vue-router3.xçš„æ—¶å€™ï¼Œrouter-linkæœ‰ä¸€ä¸ªtagå±æ€§ï¼Œå¯ä»¥å†³å®šrouter-linkåˆ°åº•**æ¸²æŸ“æˆä»€ä¹ˆå…ƒç´ **ï¼Œä½†æ˜¯åœ¨vue-router4.xå¼€å§‹ï¼Œè¯¥å±æ€§è¢«ç§»é™¤äº†ï¼›è€Œç»™æˆ‘ä»¬æä¾›äº†æ›´åŠ å…·æœ‰çµæ´»æ€§çš„**v-slot**çš„æ–¹å¼æ¥å®šåˆ¶æ¸²æŸ“çš„å†…å®¹;

* é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ **custom** è¡¨ç¤ºæˆ‘ä»¬æ•´ä¸ªå…ƒç´ è¦è‡ªå®šä¹‰ï¼›å¦‚æœä¸å†™ï¼Œé‚£ä¹ˆè‡ªå®šä¹‰çš„å†…å®¹ä¼šè¢«**åŒ…è£¹åœ¨ä¸€ä¸ª a å…ƒç´ ä¸­**;

* å…¶æ¬¡ï¼Œæˆ‘ä»¬ä½¿ç”¨v-slotæ¥ä½œç”¨åŸŸæ’æ§½æ¥è·å–å†…éƒ¨ä¼ ç»™æˆ‘ä»¬çš„å€¼: 
  * href:è§£æåçš„ URL;
  * route:è§£æåçš„è§„èŒƒåŒ–çš„routeå¯¹è±¡;
  * navigate:è§¦å‘å¯¼èˆªçš„å‡½æ•°;
  * isActive:æ˜¯å¦åŒ¹é…çš„çŠ¶æ€;
  * isExactActive:æ˜¯å¦æ˜¯ç²¾å‡†åŒ¹é…çš„çŠ¶æ€;

router-viewä¹Ÿæä¾›ç»™æˆ‘ä»¬ä¸€ä¸ªæ’æ§½ï¼Œå¯ä»¥ç”¨äº `<transition>` å’Œ `<keep-alive> `ç»„ä»¶æ¥åŒ…è£¹ä½ çš„è·¯ç”±ç»„ä»¶: 

*  Component:è¦æ¸²æŸ“çš„ç»„ä»¶;
* route:è§£æå‡ºçš„æ ‡å‡†åŒ–è·¯ç”±å¯¹è±¡;

```vue
<template>
  <div>
    <!-- props: href è·³è½¬çš„é“¾æ¥ -->
    <!-- props: routeå¯¹è±¡ -->
    <!-- props: navigateå¯¼èˆªå‡½æ•° -->
    <!-- props: isActive æ˜¯å¦å½“å‰å¤„äºæ´»è·ƒçš„çŠ¶æ€ -->
    <!-- props: isExactActive æ˜¯å¦å½“å‰å¤„äºç²¾ç¡®çš„æ´»è·ƒçŠ¶æ€ -->
    <router-link to="/home" v-slot="props" custom>
      <button @click="props.navigate">{{ props.href }}</button>
      <button @click="props.navigate">å“ˆå“ˆå“ˆ</button>
      <span :class="{ active: props.isActive }">{{ props.isActive }}</span>
      <span :class="{ active: props.isExactActive }">{{
        props.isExactActive
      }}</span>
      <!-- <p>{{props.route}}</p> -->
    </router-link>
    <br />

    <router-view v-slot="props">
      <transition name="why">
        <keep-alive>
          <component :is="props.Component"></component>
        </keep-alive>
      </transition>
    </router-view>
    <!-- <router-view /> -->
  </div>
</template>

<script setup>

</script>

<style>
.router-link-active {
  color: red;
}

.why-enter-from,
.why-leave-to {
  opacity: 0;
}

.why-enter-active,
.why-leave-active {
  transition: opacity 1s ease;
}
</style>
```







## è·¯ç”±æ‡’åŠ è½½ ğŸ”¥

å½“æ‰“åŒ…æ„å»ºåº”ç”¨æ—¶ï¼ŒJavaScript åŒ…ä¼šå˜å¾—éå¸¸å¤§ï¼Œå½±å“é¡µé¢åŠ è½½:

* å¦‚æœæˆ‘ä»¬èƒ½æŠŠä¸åŒè·¯ç”±å¯¹åº”çš„ç»„ä»¶åˆ†å‰²æˆä¸åŒçš„ä»£ç å—ï¼Œç„¶åå½“è·¯ç”±è¢«è®¿é—®çš„æ—¶å€™æ‰åŠ è½½å¯¹åº”ç»„ä»¶ï¼Œä¼šæ›´åŠ é«˜æ•ˆ;
* ä¹Ÿå¯ä»¥æé«˜é¦–å±çš„æ¸²æŸ“æ•ˆç‡;

å…¶å®è¿™é‡Œè¿˜æ˜¯æˆ‘ä»¬å‰é¢è®²åˆ°è¿‡çš„webpackçš„åˆ†åŒ…çŸ¥è¯†ï¼Œè€ŒVue Routeré»˜è®¤å°±æ”¯æŒåŠ¨æ€æ¥å¯¼å…¥ç»„ä»¶:

* è¿™æ˜¯å› ä¸ºcomponentå¯ä»¥ä¼ å…¥ä¸€ä¸ªç»„ä»¶ï¼Œä¹Ÿå¯ä»¥æ¥æ”¶ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•° éœ€è¦æ”¾å›ä¸€ä¸ªPromise; 
* è€Œ**importå‡½æ•°å°±æ˜¯è¿”å›ä¸€ä¸ªPromise**;

ä¿®æ”¹ /src/router/index.js

```js
import { createRouter, createWebHistory } from 'vue-router'

const routes = [
  {
    path: '/',
    redirect: '/home',
  },
  {
    path: '/home',
    name: 'home', // åç§°
    component: () =>
      // webpackChunkName æ‰“åŒ…èµ·åï¼Œå¿…é¡»è¿™æ ·å†™ï¼webpackçš„åŠŸèƒ½
      import(/* webpackChunkName: 'home-chunk' */ '../views/Home.vue'), // åŠ¨æ€è·¯ç”±ã€‚importè¿”å›Promise
    // å…ƒæ•°æ®
    meta: {
      name: 'conanan',
    },
  },
  {
    path: '/about',
    name: 'about',
    component: () => import('../views/About.vue'),
  },
]

const router = createRouter({
  history: createWebHistory(),
  routes,
})

export default router

```

æ‰§è¡Œæ‰“åŒ…å‘½ä»¤

```bash
npm run build
```

å¯ä»¥çœ‹å‡º

![image-20220208192826400](./images/image-20220208192826400.png)



## åŠ¨æ€è·¯ç”± ğŸ”¥

ä¿®æ”¹ /src/router/index.js

```js
const routes = [
  {
    // åŠ¨æ€è·¯ç”±ï¼Œå¿…é¡»å®Œæ•´åŒ¹é…ï¼å¦‚ä¸‹'/'åˆ†å‰²çš„4ä¸ªå‚æ•°ä¸€ä¸ªä¸èƒ½å°‘ï¼Œä¹Ÿä¸èƒ½å¤š
    path: '/user/:username/id/:id',
    name: 'user',
    component: () => import('../views/User.vue'),
  },
]
```

/src/App.vue

```vue
<template>
  <div>
    <router-link to="/user/conanan/id/10086">User</router-link>
    <router-view />
  </div>
</template>
```

/src/pages/User.vue

```vue
<template>
  <h2>User: {{ route.params.username }} - {{ route.params.id }}</h2>
</template>

<script setup>
import { useRouter, useRoute } from 'vue-router'

const router = useRouter()
console.log('router', router)

const route = useRoute()
const params = route.params
console.log('params', params)

const query = route.query
console.log('query', query)

// è¿™ç§æ–¹æ³•è·å–åˆ°æ˜¯ undefiendï¼Œå¾ˆå°´å°¬ã€‚ä¸çŸ¥é“åŸå› åœ¨å“ª
// import { getCurrentInstance } from 'vue'
// const { ctx } = getCurrentInstance()
// console.log(ctx.$router)
// console.log(ctx.$route)

// åœ¨ options api ä¸­ç›´æ¥è°ƒç”¨å¦‚ä¸‹ï¼š
// this.$route.params å³å¯
// this.$route.query å³å¯
// this.$router
</script>

<style lang="scss" scoped></style>
```





## NotFound ğŸ”¥

å¯¹äºå“ªäº›æ²¡æœ‰åŒ¹é…åˆ°çš„è·¯ç”±ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šåŒ¹é…åˆ°å›ºå®šçš„æŸä¸ªé¡µ

ä¿®æ”¹ /src/router/index.js

```js
const routes = [
  {
    path: '/:pathMatch(.*)',
    // path: '/:pathMatch(.*)*', // å¤šä¸ª*ï¼Œä¼šå°†pathæ ¹æ®'/'åˆ†å‰²è½¬ä¸ºæ•°ç»„
    component: () => import('../views/NotFound.vue'),
  },
]
```

/src/App.vue

```vue
<template>
  <div>
    <router-link to="/notfound/aa/bb/cc">NotFound</router-link> |
    <router-view />
  </div>
</template>
```

/src/pages/NotFound.vue

```vue
<template>
  <div>
    <h2>Page Not Found</h2>
    <p>æ‚¨æ‰“å¼€çš„è·¯å¾„é¡µé¢ä¸å­˜åœ¨, è¯·ä¸è¦ä½¿ç”¨æˆ‘ä»¬å®¶çš„åº”ç”¨ç¨‹åºäº†~</p>
    <h1>{{ route.params.pathMatch }}</h1>
  </div>
</template>

<script setup>
import { useRoute } from 'vue-router'
const route = useRoute()
</script>

<style scoped></style>
```





## è·¯ç”±çš„åµŒå¥— ğŸ”¥

ä»€ä¹ˆæ˜¯è·¯ç”±çš„åµŒå¥—å‘¢?

* ç›®å‰æˆ‘ä»¬åŒ¹é…çš„Homeã€Aboutã€Userç­‰éƒ½å±äºåº•å±‚è·¯ç”±ï¼Œæˆ‘ä»¬åœ¨å®ƒä»¬ä¹‹é—´å¯ä»¥æ¥å›è¿›è¡Œåˆ‡æ¢; 
* ä½†æ˜¯å‘¢ï¼Œæˆ‘ä»¬Homeé¡µé¢æœ¬èº«ï¼Œä¹Ÿå¯èƒ½ä¼šåœ¨å¤šä¸ªç»„ä»¶ä¹‹é—´æ¥å›åˆ‡æ¢ï¼šæ¯”å¦‚Homeä¸­åŒ…æ‹¬Productã€Messageï¼Œå®ƒä»¬å¯ä»¥åœ¨Homeå†…éƒ¨æ¥å›åˆ‡æ¢;
* è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨åµŒå¥—è·¯ç”±ï¼Œåœ¨Homeä¸­ä¹Ÿ**ä½¿ç”¨ router-view æ¥å ä½**ä¹‹åéœ€è¦æ¸²æŸ“çš„ç»„ä»¶

ä¿®æ”¹ /src/router/index.js

```js
const routes = [
  {
    path: '/home',
    name: 'home', // åç§°
    component: () =>
      // webpackChunkName æ‰“åŒ…èµ·åï¼Œå¿…é¡»è¿™æ ·å†™ï¼webpackçš„åŠŸèƒ½
      import(/* webpackChunkName: 'home-chunk' */ '../views/Home.vue'), // åŠ¨æ€è·¯ç”±ã€‚importè¿”å›Promise
    // å…ƒæ•°æ®
    meta: {
      name: 'conanan',
    },
    children: [
      {
        // è¿™é‡Œpathå¿…é¡»ä¸ºç©º
        path: '',
        // è¿™é‡Œå¿…é¡»å†™å…¨è·¯å¾„
        redirect: '/home/message',
      },
      {
        // è¿™é‡Œçš„pathä¸ç”¨æ‹¼æ¥çˆ¶routeçš„pathï¼Œå¹¶ä¸”ä¸å¯ä»¥å·²'/'å¼€å¤´ï¼ï¼ï¼
        path: 'message',
        name: 'message',
        component: () => import('../views/HomeMessage.vue'),
      },
      {
        path: 'shops',
        name: 'shops',
        component: () => import('../views/HomeShops.vue'),
      },
    ],
  },
]
```

/src/Home.vue

```vue
<template>
  <div>
    <h2>Home</h2>

    <router-view />

    <router-link to="/home/message">æ¶ˆæ¯</router-link> |
    <router-link to="/home/shops">å•†å“</router-link> |
    <router-link to="/home/moment">åŠ¨æ€</router-link>
  </div>
</template>

<script setup></script>

<style lang="scss" scoped></style>
```

å…¶ä»–ç»„ä»¶ç•¥







## ä»£ç è·¯ç”± ğŸ”¥

ä¿®æ”¹/src/App.vue

```vue
<template>
  <div>
    <router-link to="/home">Home</router-link> |
    <router-link to="/about">About</router-link> |
    <router-link to="/user/conanan/id/10086">User</router-link> |
    <router-link to="/notfound/aa/bb/cc">NotFound</router-link> |
    <button @click="jumpToAbout">æŸ¥çœ‹æˆ‘ï¼</button>
    <button @click="back">â†</button>
    <button @click="forword">â†’</button>
    <router-view />
  </div>
</template>

<script setup>
import { useRouter } from 'vue-router'
const router = useRouter()

const jumpToAbout = () => {
  router.push({
    path: '/about',
    query: {
      q1: 'qa1',
    },
  })
}

const forword = () => {
  router.go(1)
  // å…¶ä»–æ–¹æ³•å°±ä¸ä»‹ç»äº†
}

const back = () => {
  router.go(-1)
}
</script>

<style>
.router-link-active {
  color: red;
}
</style>
```

ä¿®æ”¹/src/pages/About.vue

```vue
<template>
  <div>
    <h2>About</h2>
    <div>{{ route.query.q1 }}</div>
  </div>
</template>

<script setup>
import { useRoute } from 'vue-router'
const route = useRoute()
</script>

<style lang="scss" scoped></style>
```





## åŠ¨æ€æ·»åŠ ã€åˆ é™¤è·¯ç”±â€”æƒé™ ğŸ”¥

### æ·»åŠ è·¯ç”±

æŸäº›æƒ…å†µä¸‹æˆ‘ä»¬å¯èƒ½éœ€è¦åŠ¨æ€çš„æ¥**æ·»åŠ è·¯ç”±**:

* æ¯”å¦‚æ ¹æ®ç”¨æˆ·ä¸åŒçš„æƒé™ï¼Œæ³¨å†Œä¸åŒçš„è·¯ç”±; 
* è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ–¹æ³• addRoute;

å¦‚æœæˆ‘ä»¬æ˜¯ä¸ºrouteæ·»åŠ ä¸€ä¸ªchildrenè·¯ç”±ï¼Œé‚£ä¹ˆå¯ä»¥ä¼ å…¥å¯¹åº”çš„name

ä¿®æ”¹ /src/router/index.js

```js
const router = createRouter({
  history: createWebHistory(),
  routes,
})

// åŠ¨æ€æ·»åŠ è·¯ç”±
const categoryRoute = {
  path: '/category',
  component: () => import('../views/Category.vue'),
}

// æ·»åŠ é¡¶çº§è·¯ç”±å¯¹è±¡
router.addRoute(categoryRoute)

// æ·»åŠ äºŒçº§è·¯ç”±å¯¹è±¡ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè·¯ç”±çš„åç§°name
router.addRoute('home', {
  path: 'moment',
  component: () => import('../views/HomeMoment.vue'),
})
```



### åˆ é™¤è·¯ç”±

ä¸å¸¸ç”¨ï¼Œ**åˆ é™¤è·¯ç”±æœ‰ä»¥ä¸‹ä¸‰ç§æ–¹å¼:**

* æ–¹å¼ä¸€ï¼šæ·»åŠ ä¸€ä¸ªnameç›¸åŒçš„è·¯ç”±;
* æ–¹å¼äºŒï¼šé€šè¿‡removeRouteæ–¹æ³•ï¼Œä¼ å…¥è·¯ç”±çš„åç§°; 
* æ–¹å¼ä¸‰ï¼šé€šè¿‡addRouteæ–¹æ³•çš„è¿”å›å€¼å›è°ƒ;

![image-20220208210535145](./images/image-20220208210535145.png)

### å…¶ä»–æ–¹æ³•

* router.hasRoute()ï¼šæ£€æŸ¥è·¯ç”±æ˜¯å¦å­˜åœ¨ã€‚
* router.getRoutes()ï¼šè·å–ä¸€ä¸ªåŒ…å«æ‰€æœ‰è·¯ç”±è®°å½•çš„æ•°ç»„



## è·¯ç”±å¯¼èˆªå®ˆå«â€”æ‹¦æˆª ğŸ”¥

### ä»‹ç»

* vue-router æä¾›çš„å¯¼èˆªå®ˆå«ä¸»è¦ç”¨æ¥é€šè¿‡**è·³è½¬**æˆ–**å–æ¶ˆ**çš„æ–¹å¼å®ˆå«å¯¼èˆªã€‚

* **å…¨å±€çš„å‰ç½®å®ˆå«beforeEachæ˜¯åœ¨å¯¼èˆªè§¦å‘æ—¶ä¼šè¢«å›è°ƒçš„**

  å®ƒæœ‰ä¸¤ä¸ªå‚æ•°:

  * to:å³å°†è¿›å…¥çš„è·¯ç”±Routeå¯¹è±¡;
  * from:å³å°†ç¦»å¼€çš„è·¯ç”±Routeå¯¹è±¡;

* å®ƒæœ‰è¿”å›å€¼:

  * false:**å–æ¶ˆå½“å‰å¯¼èˆª**;
  * ä¸è¿”å›æˆ–è€…undefined:è¿›è¡Œé»˜è®¤å¯¼èˆª; 
  * è¿”å›ä¸€ä¸ªè·¯ç”±åœ°å€:
    * å¯ä»¥æ˜¯ä¸€ä¸ªstringç±»å‹çš„è·¯å¾„;
    * å¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡ä¸­åŒ…å«pathã€queryã€paramsç­‰ä¿¡æ¯;

* å¯é€‰çš„ç¬¬ä¸‰ä¸ªå‚æ•°:next
  * åœ¨Vue2ä¸­æˆ‘ä»¬æ˜¯é€šè¿‡nextå‡½æ•°æ¥å†³å®šå¦‚ä½•è¿›è¡Œè·³è½¬çš„;
  * ä½†æ˜¯åœ¨Vue3ä¸­æˆ‘ä»¬æ˜¯é€šè¿‡è¿”å›å€¼æ¥æ§åˆ¶çš„ï¼Œä¸å†æ¨èä½¿ç”¨nextå‡½æ•°ï¼Œè¿™æ˜¯å› ä¸ºå¼€å‘ä¸­å¾ˆå®¹æ˜“è°ƒç”¨å¤šæ¬¡next;

ä¿®æ”¹ /src/router/index.js

```js
// å¯¼èˆªå®ˆå«beforeEach
let counter = 0
// to: Routeå¯¹è±¡, å³å°†è·³è½¬åˆ°çš„Routeå¯¹è±¡
// from: Routeå¯¹è±¡,
/**
 * è¿”å›å€¼é—®é¢˜:
 *    1.false: ä¸è¿›è¡Œå¯¼èˆª
 *    2.undefinedæˆ–è€…ä¸å†™è¿”å›å€¼: è¿›è¡Œé»˜è®¤å¯¼èˆª
 *    3.å­—ç¬¦ä¸²: è·¯å¾„, è·³è½¬åˆ°å¯¹åº”çš„è·¯å¾„ä¸­
 *    4.å¯¹è±¡: ç±»ä¼¼äº router.push({path: "/login", query: ....})
 */
router.beforeEach((to, from) => {
  console.log(`è¿›è¡Œäº†${++counter}è·¯ç”±è·³è½¬`)
  // if (to.path.indexOf("/home") !== -1) {
  //   return "/login"
  // }
  if (to.path !== '/login') {
    const token = window.localStorage.getItem('token')
    if (!token) {
      return '/login'
    }
  }
})
```



### ç™»å½•å®ˆå«åŠŸèƒ½

/src/Login.vue

```vue
<template>
  <div>
    <button @click="loginClick">ç™»å½•</button>
  </div>
</template>

<script setup>
import { useRouter } from 'vue-router'

const router = useRouter()

const loginClick = () => {
  window.localStorage.setItem('token', 'why')

  router.push({
    path: '/home',
  })
}
</script>

<style scoped></style>
```

æ³¨å†Œè·¯ç”±

```js
{
  path: '/login',
  component: () => import('../views/Login.vue'),
},
```

ä¿®æ”¹ /src/router/index.js

```js
// å¯¼èˆªå®ˆå«beforeEach
router.beforeEach((to, from) => {
  if (to.path !== '/login') {
    const token = window.localStorage.getItem('token')
    if (!token) {
      return '/login'
    }
  }
})
```





### å…¶ä»–å¯¼èˆªå®ˆå«

Vueè¿˜æä¾›äº†å¾ˆå¤šçš„[å…¶ä»–å®ˆå«å‡½æ•°](https://next.router.vuejs.org/zh/guide/advanced/navigation-guards.html)ï¼Œç›®çš„éƒ½æ˜¯åœ¨æŸä¸€ä¸ªæ—¶åˆ»ç»™äºˆæˆ‘ä»¬å›è°ƒï¼Œè®©æˆ‘ä»¬å¯ä»¥æ›´å¥½çš„æ§åˆ¶ç¨‹åºçš„æµç¨‹æˆ–è€…åŠŸèƒ½

**å®Œæ•´çš„å¯¼èˆªè§£ææµç¨‹**:

* å¯¼èˆªè¢«è§¦å‘ã€‚
* åœ¨å¤±æ´»çš„ç»„ä»¶é‡Œè°ƒç”¨ beforeRouteLeave å®ˆå«ã€‚
* è°ƒç”¨å…¨å±€çš„ beforeEach å®ˆå«ã€‚
* åœ¨é‡ç”¨çš„ç»„ä»¶é‡Œè°ƒç”¨ beforeRouteUpdate å®ˆå«(2.2+)ã€‚
* åœ¨è·¯ç”±é…ç½®é‡Œè°ƒç”¨ beforeEnterã€‚
* è§£æå¼‚æ­¥è·¯ç”±ç»„ä»¶ã€‚
* åœ¨è¢«æ¿€æ´»çš„ç»„ä»¶é‡Œè°ƒç”¨ beforeRouteEnterã€‚
* è°ƒç”¨å…¨å±€çš„ beforeResolve å®ˆå«(2.5+)ã€‚
* å¯¼èˆªè¢«ç¡®è®¤ã€‚
* è°ƒç”¨å…¨å±€çš„ afterEach é’©å­ã€‚
* è§¦å‘ DOM æ›´æ–°ã€‚
* è°ƒç”¨ beforeRouteEnter å®ˆå«ä¸­ä¼ ç»™ next çš„å›è°ƒå‡½æ•°ï¼Œåˆ›å»ºå¥½çš„ç»„ä»¶å®ä¾‹ä¼šä½œä¸ºå›è°ƒå‡½æ•°çš„å‚æ•°ä¼ å…¥ã€‚
