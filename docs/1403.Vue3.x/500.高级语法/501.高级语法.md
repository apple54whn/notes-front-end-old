---
title: é«˜çº§è¯­æ³•
date: 2022-02-04 19:15:00
permalink: /pages/2b61b7/
categories:
  - x
  - Composition Api
tags:
  - 
---

# é«˜çº§è¯­æ³•

## h å‡½æ•° ğŸ”¥

### ä»‹ç»

è¿”å›ä¸€ä¸ªâ€è™šæ‹ŸèŠ‚ç‚¹â€œï¼Œé€šå¸¸ç¼©å†™ä¸º **VNode**ï¼šä¸€ä¸ªæ™®é€šå¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«å‘ Vue æè¿°å®ƒåº”åœ¨é¡µé¢ä¸Šæ¸²æŸ“å“ªç§èŠ‚ç‚¹çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ‰€æœ‰å­èŠ‚ç‚¹çš„æè¿°ã€‚å®ƒçš„ç›®çš„æ˜¯ç”¨äºæ‰‹åŠ¨ç¼–å†™çš„[æ¸²æŸ“å‡½æ•°](https://v3.cn.vuejs.org/guide/render-function.html)ï¼š

Vueæ¨èåœ¨ç»å¤§æ•°æƒ…å†µä¸‹**ä½¿ç”¨æ¨¡æ¿**æ¥åˆ›å»ºä½ çš„HTMLï¼Œç„¶åä¸€äº›ç‰¹æ®Šçš„åœºæ™¯ï¼Œä½ çœŸçš„éœ€è¦**JavaScriptçš„å®Œå…¨ç¼–ç¨‹çš„èƒ½åŠ›**ï¼Œè¿™ä¸ªæ—¶å€™ä½ å¯ä»¥ä½¿ç”¨ **h æ¸²æŸ“å‡½æ•°** ï¼Œå®ƒ**æ¯”æ¨¡æ¿æ›´æ¥è¿‘ç¼–è¯‘å™¨**;

* å‰é¢æˆ‘ä»¬è®²è§£è¿‡**VNode**å’Œ**VDOM**çš„æ”¹å˜ï¼šVueåœ¨ç”ŸæˆçœŸå®çš„DOMä¹‹å‰ï¼Œä¼šå°†æˆ‘ä»¬çš„èŠ‚ç‚¹è½¬æ¢æˆ**VNode**ï¼Œè€ŒVNodeç»„åˆåœ¨ä¸€èµ·å½¢æˆä¸€é¢—æ ‘ç»“æ„ï¼Œå°±æ˜¯è™šæ‹ŸDOM(**VDOM**);

* äº‹å®ä¸Šï¼Œæˆ‘ä»¬ä¹‹å‰ç¼–å†™çš„ template ä¸­çš„HTML æœ€ç»ˆä¹Ÿæ˜¯ä½¿ç”¨**æ¸²æŸ“å‡½æ•°**ç”Ÿæˆå¯¹åº”çš„**VNode**; 
* é‚£ä¹ˆï¼Œå¦‚æœä½ æƒ³å……åˆ†çš„åˆ©ç”¨JavaScriptçš„ç¼–ç¨‹èƒ½åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±æ¥ç¼–å†™ **createVNode** å‡½æ•°ï¼Œç”Ÿæˆå¯¹åº”çš„**VNode**;

é‚£ä¹ˆæˆ‘ä»¬åº”è¯¥æ€ä¹ˆæ¥åšå‘¢?**ä½¿ç”¨ h()å‡½æ•°**:

* **h()** å‡½æ•°æ˜¯ä¸€ä¸ªç”¨äºåˆ›å»º **VNode** çš„ä¸€ä¸ªå‡½æ•°;
* å…¶å®æ›´å‡†å¤‡çš„å‘½åæ˜¯ **createVNode()** å‡½æ•°ï¼Œä½†æ˜¯ä¸ºäº†ç®€ä¾¿åœ¨Vueå°†ä¹‹ç®€åŒ–ä¸º **h()** å‡½æ•°;

```js
render() {
  return h('h1', {}, 'Some title')
}
```



### å‚æ•° ğŸ”¥

æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼š`type`ï¼Œ`props` å’Œ `children`

#### type

- **ç±»å‹ï¼š**`String | Object | Function`

- **è¯¦ç»†ï¼š**

  HTML æ ‡ç­¾åã€ç»„ä»¶ã€å¼‚æ­¥ç»„ä»¶æˆ–å‡½æ•°å¼ç»„ä»¶ã€‚ä½¿ç”¨è¿”å› null çš„å‡½æ•°å°†æ¸²æŸ“ä¸€ä¸ªæ³¨é‡Šã€‚æ­¤å‚æ•°æ˜¯å¿…éœ€çš„ã€‚

#### props

- **ç±»å‹ï¼š**`Object`

- **è¯¦ç»†ï¼š**

  ä¸€ä¸ªå¯¹è±¡ï¼Œä¸æˆ‘ä»¬å°†åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨çš„ attributeã€prop å’Œäº‹ä»¶ç›¸å¯¹åº”ã€‚å¯é€‰ã€‚

#### children

- **ç±»å‹ï¼š**`String | Array | Object`

- **è¯¦ç»†ï¼š**

  å­ä»£ VNodeï¼Œä½¿ç”¨ `h()` ç”Ÿæˆï¼Œæˆ–è€…ä½¿ç”¨å­—ç¬¦ä¸²æ¥è·å–â€œæ–‡æœ¬ VNodeâ€ï¼Œæˆ–å¸¦æœ‰æ’æ§½çš„å¯¹è±¡ã€‚å¯é€‰ã€‚

  ```js
  h('div', {}, [
    'Some text comes first.',
    h('h1', 'A headline'),
    h(MyComponent, {
      someProp: 'foobar'
    })
  ])
  ```



### h å‡½æ•°çš„åŸºæœ¬ä½¿ç”¨

**hå‡½æ•°å¯ä»¥åœ¨ä¸¤ä¸ªåœ°æ–¹ä½¿ç”¨**:

* renderå‡½æ•°é€‰é¡¹ä¸­;

  ```vue
  <script>
    import { h } from 'vue';
  
    export default {
      render() {
        return h("h2", {class: "title"}, "Hello Render")
      }
    }
  </script>
  ```

* setupå‡½æ•°é€‰é¡¹ä¸­(setupæœ¬èº«éœ€è¦æ˜¯ä¸€ä¸ªå‡½æ•°ç±»å‹ï¼Œå‡½æ•°å†è¿”å›hå‡½æ•°åˆ›å»ºçš„VNode);

  ```vue
  <script>
    import { h } from 'vue';
  
    export default {
      setup() {
        return () => h("h2", {class: "title"}, "Hello Render")
      }
    }
  </script>
  ```

  



### render å‡½æ•°å®ç°è®¡æ•°å™¨

```vue
<script>
  import { h } from 'vue';

  export default {
    data() {
      return {
        counter: 0
      }
    },
    render() {
      return h("div", {class: "app"}, [
        h("h2", null, `å½“å‰è®¡æ•°: ${this.counter}`),
        h("button", {
          onClick: () => this.counter++
        }, "+1"),
        h("button", {
          onClick: () => this.counter--
        }, "-1"),
      ])
    }
  }
</script>
```

å¤ªéº»çƒ¦äº†ï¼Œå¯ä»¥ä½¿ç”¨JSXæ›¿ä»£ã€‚





### setup å‡½æ•°å®ç°è®¡æ•°å™¨

```vue
<script>
  import { ref, h } from 'vue';

  export default {
    setup() {
      const counter = ref(0);
      
      return () => {
        return h("div", {class: "app"}, [
          h("h2", null, `å½“å‰è®¡æ•°: ${counter.value}`),
          h("button", {
            onClick: () => counter.value++
          }, "+1"),
          h("button", {
            onClick: () => counter.value--
          }, "-1"),
        ])
      }
    }
  }
</script>
```



### ç»„ä»¶å’Œæ’æ§½çš„ä½¿ç”¨

App.vue

```vue
<script>
import { h } from 'vue'
import HelloWorld from './HelloWorld.vue'

export default {
  render() {
    return h('div', null, [
      h(HelloWorld, null, {
        // default æ’æ§½ï¼›ä½œç”¨åŸŸæ’æ§½
        default: (props) =>
          h('span', null, `appä¼ å…¥åˆ°HelloWorldä¸­çš„å†…å®¹: ${props.name}`),
      }),
    ])
  },
}
</script>

<style scoped></style>
```

HelloWorld.vue

```vue
<script>
import { h } from 'vue'

export default {
  render() {
    return h('div', null, [
      h('h2', null, 'Hello World'),
      // default æ’æ§½ï¼›
      this.$slots.default
        ? this.$slots.default({ name: 'coderwhy' })
        : h('span', null, 'æˆ‘æ˜¯HelloWorldçš„æ’æ§½é»˜è®¤å€¼'),
    ])
  },
}
</script>

<style lang="scss" scoped></style>

```





## JSX ğŸ”¥

### å…¥é—¨

å¦‚æœæˆ‘ä»¬å¸Œæœ›**åœ¨é¡¹ç›®ä¸­ä½¿ç”¨jsx**ï¼Œé‚£ä¹ˆæˆ‘ä»¬**éœ€è¦æ·»åŠ å¯¹jsxçš„æ”¯æŒ**:

* jsxæˆ‘ä»¬é€šå¸¸ä¼šé€šè¿‡Babelæ¥è¿›è¡Œè½¬æ¢ï¼ˆReactç¼–å†™çš„jsxå°±æ˜¯é€šè¿‡babelè½¬æ¢çš„ï¼‰; 
* å¯¹äºVueæ¥è¯´ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨Babelä¸­é…ç½®å¯¹åº”çš„æ’ä»¶å³å¯ï¼ˆå½“å‰ç‰ˆæœ¬æ— éœ€é…ç½®ï¼‰; 

ï¼ˆæ ¹æ®æ˜¯å¦éœ€è¦é…ç½®ï¼‰å®‰è£…**Babelæ”¯æŒVueçš„jsxæ’ä»¶**ï¼š

```bash
 npm install @vue/babel-plugin-jsx -D
```

ï¼ˆæ ¹æ®æ˜¯å¦éœ€è¦é…ç½®ï¼‰åœ¨**babel.config.jsé…ç½®æ–‡ä»¶**ä¸­é…ç½®æ’ä»¶

```js
module.exports = {
  presets: [
    '@vue/cli-plugin-babel/preset'
  ]
}

```



### JSX è®¡æ•°å™¨æ¡ˆä¾‹

App.vue

```vue
<script>
  import HelloWorld from './HelloWorld.vue';

  export default {
    data() {
      return {
        counter: 0
      }
    },

    render() {
      const increment = () => this.counter++;
      const decrement = () => this.counter--;

      return (
        <div>
          <h2>å½“å‰è®¡æ•°: {this.counter}</h2>
          <button onClick={increment}>+1</button>
          <button onClick={decrement}>-1</button>
          <HelloWorld>
          </HelloWorld>
        </div>
      )
    }
  }
</script>

<style lang="scss" scoped>

</style>
```

HelloWorld.vue

```vue
<script>
  export default {
    render() {
      return (
        <div>
          <h2>HelloWorld</h2>
          {this.$slots.default ? this.$slots.default(): <span>å“ˆå“ˆå“ˆ</span>}
        </div>
      )
    }
  }
</script>

<style scoped>

</style>
```



## è‡ªå®šä¹‰æŒ‡ä»¤ ğŸ”¥

### ä»‹ç»

åœ¨Vueçš„æ¨¡æ¿è¯­æ³•ä¸­æˆ‘ä»¬å­¦ä¹ è¿‡å„ç§å„æ ·çš„æŒ‡ä»¤ï¼šv-showã€v-forã€v-modelç­‰ç­‰ï¼Œé™¤äº†ä½¿ç”¨è¿™äº›æŒ‡ä»¤ä¹‹å¤–ï¼Œ**Vue ä¹Ÿå…è®¸æˆ‘ä»¬æ¥è‡ªå®šä¹‰è‡ªå·±çš„æŒ‡ä»¤ã€‚**

* æ³¨æ„:åœ¨Vueä¸­ï¼Œ**ä»£ç çš„å¤ç”¨å’ŒæŠ½è±¡**ä¸»è¦è¿˜æ˜¯é€šè¿‡**ç»„ä»¶**;
* é€šå¸¸åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ éœ€è¦**å¯¹DOMå…ƒç´ è¿›è¡Œåº•å±‚æ“ä½œ**ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šç”¨åˆ°**è‡ªå®šä¹‰æŒ‡ä»¤**;

**è‡ªå®šä¹‰æŒ‡ä»¤åˆ†ä¸ºä¸¤ç§** :

* è‡ªå®šä¹‰å±€éƒ¨æŒ‡ä»¤ï¼šç»„ä»¶ä¸­é€šè¿‡ **directives** é€‰é¡¹ï¼Œåªèƒ½åœ¨å½“å‰ç»„ä»¶ä¸­ä½¿ç”¨; 
* è‡ªå®šä¹‰å…¨å±€æŒ‡ä»¤ï¼šappçš„ **directive** æ–¹æ³•ï¼Œå¯ä»¥åœ¨ä»»æ„ç»„ä»¶ä¸­è¢«ä½¿ç”¨;

**æ¯”å¦‚æˆ‘ä»¬æ¥åšä¸€ä¸ªéå¸¸ç®€å•çš„æ¡ˆä¾‹:å½“æŸä¸ªå…ƒç´ æŒ‚è½½å®Œæˆåå¯ä»¥è‡ªå®šè·å–ç„¦ç‚¹** 

* å®ç°æ–¹å¼ä¸€:å¦‚æœæˆ‘ä»¬ä½¿ç”¨é»˜è®¤çš„å®ç°æ–¹å¼;
* å®ç°æ–¹å¼äºŒ:è‡ªå®šä¹‰ä¸€ä¸ª v-focus çš„å±€éƒ¨æŒ‡ä»¤; 
* å®ç°æ–¹å¼ä¸‰:è‡ªå®šä¹‰ä¸€ä¸ª v-focus çš„å…¨å±€æŒ‡ä»¤;



### é»˜è®¤çš„å®ç°æ–¹å¼

```vue
<template>
  <div>
    <input type="text" ref="input">
  </div>
</template>

<script>
  import { ref, onMounted } from "vue";

  export default {
    setup() {
      const input = ref(null);

      onMounted(() => {
        input.value.focus();
      })

      return {
        input
      }
    }
  }
</script>
```



### å±€éƒ¨è‡ªå®šä¹‰æŒ‡ä»¤

* åœ¨**ç»„ä»¶ options é€‰é¡¹ä¸­**ä½¿ç”¨ **directives** å³å¯
* å®ƒæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨å¯¹è±¡ä¸­ç¼–å†™æˆ‘ä»¬è‡ªå®šä¹‰æŒ‡ä»¤çš„åç§°ï¼ˆæ³¨æ„:è¿™é‡Œä¸éœ€è¦åŠ `v-`ï¼‰
* è‡ªå®šä¹‰æŒ‡ä»¤æœ‰ä¸€ä¸ª**ç”Ÿå‘½å‘¨æœŸ**ï¼Œæ˜¯åœ¨ç»„ä»¶æŒ‚è½½åè°ƒç”¨çš„ mountedï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸­å®Œæˆæ“ä½œ

```vue
<template>
  <div>
    <input type="text" v-focus>
  </div>
</template>

<script>
  export default {
    // å±€éƒ¨æŒ‡ä»¤
    directives: {
      focus: {
        mounted(el, bindings, vnode, preVnode) {
          console.log("focus mounted");
          el.focus();
        }
      }
    }
  }
</script>
```





### å…¨å±€è‡ªå®šä¹‰æŒ‡ä»¤ ğŸ”¥

ä¸Šé¢çš„å±€éƒ¨è‡ªå®šä¹‰æŒ‡ä»¤ä¿®æ”¹ï¼š

main.js

```js
import { createApp } from 'vue'

const app = createApp(App)

app.directive("focus", {
  mounted(el, bindings, vnode, preVnode) {
    console.log("focus mounted");
    el.focus();
  }
})

app.mount('#app')
```

ç„¶åç›´æ¥ä½¿ç”¨å³å¯ï¼ï¼ï¼



### æŒ‡ä»¤çš„ç”Ÿå‘½å‘¨æœŸã€å‚æ•°ã€ä¿®é¥°ç¬¦ ğŸ”¥

**ä¸€ä¸ªæŒ‡ä»¤å®šä¹‰çš„å¯¹è±¡ï¼ŒVueæä¾›äº†å¦‚ä¸‹çš„å‡ ä¸ªé’©å­å‡½æ•°**ï¼š

* createdï¼šåœ¨ç»‘å®šå…ƒç´ çš„ attribute æˆ–äº‹ä»¶ç›‘å¬å™¨è¢«åº”ç”¨**ä¹‹å‰**è°ƒç”¨;
* beforeMountï¼šå½“**æŒ‡ä»¤ç¬¬ä¸€æ¬¡ç»‘å®š**åˆ°å…ƒç´ å¹¶ä¸”åœ¨**æŒ‚è½½çˆ¶ç»„ä»¶ä¹‹å‰**è°ƒç”¨; 
* **mounted**ï¼šåœ¨ç»‘å®šå…ƒç´ çš„çˆ¶ç»„ä»¶**è¢«æŒ‚è½½åè°ƒç”¨**; 
* beforeUpdateï¼šåœ¨æ›´æ–°åŒ…å«ç»„ä»¶çš„ VNode ä¹‹å‰è°ƒç”¨; 
* updatedï¼šåœ¨åŒ…å«ç»„ä»¶çš„ VNode **åŠå…¶å­ç»„ä»¶çš„ VNode** æ›´æ–°åè°ƒç”¨; 
* beforeUnmountï¼šåœ¨å¸è½½ç»‘å®šå…ƒç´ çš„çˆ¶ç»„ä»¶ä¹‹å‰è°ƒç”¨;
* unmountedï¼šå½“æŒ‡ä»¤ä¸å…ƒç´ è§£é™¤ç»‘å®šä¸”çˆ¶ç»„ä»¶å·²å¸è½½æ—¶ï¼Œåªè°ƒç”¨ä¸€æ¬¡;

åœ¨æˆ‘ä»¬çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œæˆ‘ä»¬å¯ä»¥**é€šè¿‡ bindings è·å–åˆ°å¯¹åº”çš„å‚æ•°ï¼ˆvalueï¼‰å’Œä¿®é¥°ç¬¦å¯¹è±¡ï¼ˆmodifiersï¼‰**

```vue
<template>
  <div>
    <button v-if="counter < 2" v-why.aaaa.bbbb="'coderwhy'" @click="increment">å½“å‰è®¡æ•°: {{counter}}</button>
  </div>
</template>

<script>
  import { ref } from "vue";

  export default {
    // å±€éƒ¨æŒ‡ä»¤
    directives: {
      why: {
        // preVnode åœ¨ updated èŠ‚ç‚¹ä¼šæœ‰å€¼
        created(el, bindings, vnode, preVnode) {
          console.log("why created", el, bindings, vnode, preVnode);
          console.log(bindings.value);// å­—ç¬¦ä¸²
          console.log(bindings.modifiers);// æ˜¯ä¸ªå¯¹è±¡
        },
        beforeMount() {
          console.log("why beforeMount");
        },
        mounted() {
          console.log("why mounted");
        },
        beforeUpdate() {
          console.log("why beforeUpdate");
        },
        updated() {
          console.log("why updated");
        },
        beforeUnmount() {
          console.log("why beforeUnmount");
        },
        unmounted() {
          console.log("why unmounted");
        }
      }
    },
    setup() {
      const counter = ref(0);
      const increment = () => counter.value++;

      return {
        counter,
        increment
      }
    }
  }
</script>
```





### æ—¶é—´æˆ³æ ¼å¼åŒ–æŒ‡ä»¤ ğŸ”¥ğŸ”¥ğŸ”¥

å¼€å‘è¦æ±‚ï¼š

* åœ¨å¼€å‘ä¸­ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ä»æœåŠ¡å™¨è·å–åˆ°çš„éƒ½æ˜¯æ—¶é—´æˆ³;
* æˆ‘ä»¬éœ€è¦å°†æ—¶é—´æˆ³è½¬æ¢æˆå…·ä½“æ ¼å¼åŒ–çš„æ—¶é—´æ¥å±•ç¤º;
* åœ¨Vue2ä¸­æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿‡æ»¤å™¨æ¥å®Œæˆ;
* åœ¨Vue3ä¸­æˆ‘ä»¬å¯ä»¥é€šè¿‡ è®¡ç®—å±æ€§(computed) æˆ–è€… è‡ªå®šä¹‰ä¸€ä¸ªæ–¹æ³•(methods) æ¥å®Œæˆ; 
* å…¶å®æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ä¸€ä¸ªè‡ªå®šä¹‰çš„æŒ‡ä»¤æ¥å®Œæˆ;

å®ç°ä¸€ä¸ªå¯ä»¥è‡ªåŠ¨å¯¹**æ—¶é—´æ ¼å¼åŒ–çš„æŒ‡ä»¤v-format-time**

/src/directives/index.js

```js
import registerFormatTime from './format-time';

export default function registerDirectives(app) {
  registerFormatTime(app);
}
```

/src/directives/format-time.js

```js
import dayjs from 'dayjs'

export default function (app) {
  app.directive('format-time', {
    created(el, bindings) {
      bindings.formatString = 'YYYY-MM-DD HH:mm:ss'
      if (bindings.value) {
        bindings.formatString = bindings.value
      }
    },
    // éƒ½æ”¾å…¥ mounted ä¹Ÿä¸€æ ·ï¼
    mounted(el, bindings) {
      const textContent = el.textContent
      let timestamp = parseInt(textContent)
      if (textContent.length === 10) {
        timestamp = timestamp * 1000
      }
      el.textContent = dayjs(timestamp).format(bindings.formatString)
    },
  })
}
```

/src/main.js

```js
import registerDirectives from './directives'
registerDirectives(app)
```





## Teleportâ€”Vue3

 åœ¨ç»„ä»¶åŒ–å¼€å‘ä¸­ï¼Œæˆ‘ä»¬**å°è£…ä¸€ä¸ªç»„ä»¶A**ï¼Œåœ¨**å¦å¤–ä¸€ä¸ªç»„ä»¶Bä¸­ä½¿ç”¨**:

* é‚£ä¹ˆç»„ä»¶Aä¸­templateçš„å…ƒç´ ï¼Œä¼šè¢«æŒ‚è½½åˆ°ç»„ä»¶Bä¸­templateçš„æŸä¸ªä½ç½®;
* æœ€ç»ˆæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¼šå½¢æˆ**ä¸€é¢—DOMæ ‘ç»“æ„**;

ä½†æ˜¯æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›**ç»„ä»¶ä¸æ˜¯æŒ‚è½½åœ¨è¿™ä¸ªç»„ä»¶æ ‘ä¸Š**çš„ï¼Œå¯èƒ½æ˜¯**ç§»åŠ¨åˆ°Vue appä¹‹å¤–çš„å…¶ä»–ä½ç½®**: 

* æ¯”å¦‚ç§»åŠ¨åˆ°bodyå…ƒç´ ä¸Šï¼Œæˆ–è€…æˆ‘ä»¬æœ‰**å…¶ä»–çš„div#appä¹‹å¤–çš„å…ƒç´ ä¸Š**; 
* è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡teleportæ¥å®Œæˆ;

**Teleportæ˜¯ä»€ä¹ˆå‘¢?** 

* å®ƒæ˜¯ä¸€ä¸ªVueæä¾›çš„**å†…ç½®ç»„ä»¶**ï¼Œç±»ä¼¼äºreactçš„ Portals; 
* teleportç¿»è¯‘è¿‡æ¥æ˜¯å¿ƒçµä¼ è¾“ã€è¿œè·ç¦»è¿è¾“çš„æ„æ€;
* å®ƒæœ‰ä¸¤ä¸ªå±æ€§:
  * toï¼šæŒ‡å®šå°†å…¶ä¸­çš„å†…å®¹ç§»åŠ¨åˆ°çš„ç›®æ ‡å…ƒç´ ï¼Œå¯ä»¥ä½¿ç”¨é€‰æ‹©å™¨; 
  * disabledï¼šæ˜¯å¦ç¦ç”¨ teleport çš„åŠŸèƒ½;
* å¦‚æœæˆ‘ä»¬å°†**å¤šä¸ªteleportåº”ç”¨**åˆ°**åŒä¸€ä¸ªç›®æ ‡ä¸Š(toçš„å€¼ç›¸åŒ)**ï¼Œé‚£ä¹ˆè¿™äº›**ç›®æ ‡ä¼šè¿›è¡Œåˆå¹¶**

å¯èƒ½ä¼šæƒ³åˆ° element çš„ç±»ä¼¼`this.showMessage()`**å¼¹çª—**åŠŸèƒ½ï¼Œä½†å…¶å®ä¸æ˜¯ä½¿ç”¨è¯¥æ–¹å¼å®ç°çš„ï¼

/public/index.html

```html
<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="icon" href="<%= BASE_URL %>favicon.ico">
    <title><%= htmlWebpackPlugin.options.title %></title>
  </head>
  <body>
    <noscript>
      <strong>We're sorry but <%= htmlWebpackPlugin.options.title %> doesn't work properly without JavaScript enabled. Please enable it to continue.</strong>
    </noscript>
    <div id="app"></div>
    
    <div id="why"></div>
    <!-- built files will be auto injected -->
  </body>
</html>
```

HelloWorld.vue

```vue
<template>
  <div>
    <h2>Hello World</h2>
  </div>
</template>

<script>
  export default {
    
  }
</script>
```

App.vue

```vue
<template>
  <div class="app">
    <teleport to="#why">
      <h2>å½“å‰è®¡æ•°</h2>
      <button>+1</button>
      <hello-world></hello-world>
    </teleport>

    <teleport to="#why">
      <span>å‘µå‘µå‘µå‘µ</span>
    </teleport>
  </div>
</template>

<script>
  import { getCurrentInstance } from "vue";

  import HelloWorld from './HelloWorld.vue';

  export default {
    components: {
      HelloWorld
    },
    setup() {
      const instance = getCurrentInstance();
      console.log(instance.appContext.config.globalProperties.$name);
    },
    mounted() {
      console.log(this.$name);
    },
    methods: {
      foo() {
        console.log(this.$name);
      }
    }
  }
</script>
```





## æ’ä»¶ ğŸ”¥

### ä»‹ç»

é€šå¸¸æˆ‘ä»¬**å‘Vueå…¨å±€æ·»åŠ ä¸€äº›åŠŸèƒ½**æ—¶ï¼Œä¼šé‡‡ç”¨**æ’ä»¶çš„æ¨¡å¼ï¼Œå®ƒæœ‰ä¸¤ç§ç¼–å†™æ–¹å¼**: 

* **å¯¹è±¡ç±»å‹**ï¼šä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯å¿…é¡»åŒ…å«ä¸€ä¸ª install çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šåœ¨å®‰è£…æ’ä»¶æ—¶æ‰§è¡Œ; 
* **å‡½æ•°ç±»å‹**ï¼šä¸€ä¸ªfunctionï¼Œè¿™ä¸ªå‡½æ•°ä¼šåœ¨å®‰è£…æ’ä»¶æ—¶è‡ªåŠ¨æ‰§è¡Œ;

æ’ä»¶å¯ä»¥**å®Œæˆçš„åŠŸèƒ½æ²¡æœ‰é™åˆ¶**ï¼Œæ¯”å¦‚ä¸‹é¢çš„å‡ ç§éƒ½æ˜¯å¯ä»¥çš„ï¼š

* æ·»åŠ **å…¨å±€æ–¹æ³•æˆ–è€… property**ï¼Œé€šè¿‡æŠŠå®ƒä»¬æ·»åŠ åˆ° **config.globalProperties** ä¸Šå®ç°; 
* æ·»åŠ **å…¨å±€èµ„æº**:**æŒ‡ä»¤/è¿‡æ»¤å™¨/è¿‡æ¸¡**ç­‰;
* é€šè¿‡**å…¨å±€ mixin** æ¥æ·»åŠ ä¸€äº›ç»„ä»¶é€‰é¡¹;
* **ä¸€ä¸ªåº“**ï¼Œæä¾›è‡ªå·±çš„ APIï¼Œ**åŒæ—¶æä¾›**ä¸Šé¢æåˆ°çš„ä¸€ä¸ªæˆ–å¤šä¸ªåŠŸèƒ½;



### ç¤ºä¾‹

/src/plugins/plugins_object.js

```js
export default {
  install(app) {
    app.config.globalProperties.$name = "coderwhy"
  }
}
```

/src/plugins/plugins_function.js

```js
export default function(app) {
  console.log(app);
}
```

/src/main.js

```js
import { createApp } from 'vue'

import pluginObject from './plugins/plugins_object'
import pluginFunction from './plugins/plugins_function'

const app = createApp(App)

// è¿™é‡Œåº•å±‚è‡ªåŠ¨æ‰§è¡Œ plugin.install(app)
app.use(pluginObject)
app.use(pluginFunction)

app.mount('#app')
```

ä½¿ç”¨è¯¥å±æ€§

```vue
<template>
</template>

<script>
  import { getCurrentInstance } from "vue";

  export default {
    // setup åªèƒ½é€šè¿‡è¯¥æ–¹å¼è·å–ã€‚å…¶ä»–çš„æ­£å¸¸ä½¿ç”¨ this å³å¯
    setup() {
      const instance = getCurrentInstance();
      console.log(instance.appContext.config.globalProperties.$name);
    },
    mounted() {
      console.log(this.$name);
    },
    methods: {
      foo() {
        console.log(this.$name);
      }
    }
  }
</script>
```

