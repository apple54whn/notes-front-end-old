---
title: å…¶ä»–
date: 2022-02-04 17:23:43
permalink: /pages/563ede/
categories:
  - x
  - Composition Api
tags:
  - 
---

# å…¶ä»–

## ç”Ÿå‘½å‘¨æœŸé’©å­ ğŸ”¥

setupä¸­å¦‚ä½•ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸå‡½æ•°å‘¢ï¼Ÿå¯ä»¥ä½¿ç”¨ç›´æ¥å¯¼å…¥çš„ onX å‡½æ•°æ³¨å†Œç”Ÿå‘½å‘¨æœŸé’©å­ï¼š

* å¯ä»¥**æ¯ä¸ªä½¿ç”¨å¤šæ¬¡**ï¼

ä¸‹è¡¨åŒ…å«å¦‚ä½•åœ¨`setup()`å†…éƒ¨è°ƒç”¨ç”Ÿå‘½å‘¨æœŸé’©å­ï¼š

| é€‰é¡¹å¼ API        | Hook inside `setup` |
| ----------------- | ------------------- |
| `beforeCreate`    | Not needed*         |
| `created`         | Not needed*         |
| `beforeMount`     | `onBeforeMount`     |
| `mounted`         | `onMounted`         |
| `beforeUpdate`    | `onBeforeUpdate`    |
| `updated`         | `onUpdated`         |
| `beforeUnmount`   | `onBeforeUnmount`   |
| `unmounted`       | `onUnmounted`       |
| `errorCaptured`   | `onErrorCaptured`   |
| `renderTracked`   | `onRenderTracked`   |
| `renderTriggered` | `onRenderTriggered` |
| `activated`       | `onActivated`       |
| `deactivated`     | `onDeactivated`     |

å› ä¸º `setup` æ˜¯å›´ç»• `beforeCreate` å’Œ `created` ç”Ÿå‘½å‘¨æœŸé’©å­è¿è¡Œçš„ï¼Œæ‰€ä»¥ä¸éœ€è¦æ˜¾å¼åœ°å®šä¹‰å®ƒä»¬ã€‚æ¢å¥è¯è¯´ï¼Œåœ¨è¿™äº›é’©å­ä¸­ç¼–å†™çš„ä»»ä½•ä»£ç éƒ½åº”è¯¥ç›´æ¥åœ¨ `setup` å‡½æ•°ä¸­ç¼–å†™ã€‚



## Provide & Inject å‡½æ•°â€”ä¸æ¨è

äº‹å®ä¸Šæˆ‘ä»¬ä¹‹å‰è¿˜å­¦ä¹ è¿‡Provideå’ŒInjectï¼ŒComposition APIä¹Ÿå¯ä»¥æ›¿ä»£ä¹‹å‰çš„ Provide å’Œ Inject çš„é€‰é¡¹

æˆ‘ä»¬å¯ä»¥é€šè¿‡ provideæ¥æä¾›æ•°æ®:

* å¯ä»¥é€šè¿‡ provide æ–¹æ³•æ¥å®šä¹‰æ¯ä¸ª Property; 
* provideå¯ä»¥ä¼ å…¥ä¸¤ä¸ªå‚æ•°:
  * name:æä¾›çš„å±æ€§åç§°; 
  * value:æä¾›çš„å±æ€§å€¼;

åœ¨ **åä»£ç»„ä»¶** ä¸­å¯ä»¥é€šè¿‡ inject æ¥æ³¨å…¥éœ€è¦çš„å±æ€§å’Œå¯¹åº”çš„å€¼ï¼š

* injectå¯ä»¥ä¼ å…¥ä¸¤ä¸ªå‚æ•°:
  * è¦ inject çš„ property çš„ name; 
  * é»˜è®¤å€¼;

```vue
<template>
  <div>
    <home/>
    <h2>App Counter: {{counter}}</h2>
    <button @click="increment">Appä¸­çš„+1</button>
  </div>
</template>

<script>
  import { provide, ref, readonly } from 'vue';

  import Home from './Home.vue';

  export default {
    components: {
      Home
    },
    setup() {
      const name = ref("coderwhy");
      let counter = ref(100);

      provide("name", readonly(name));
      provide("counter", readonly(counter));

      const increment = () => counter.value++;

      return {
        increment,
        counter
      }
    }
  }
</script>
```

```vue
<template>
  <div>
    <h2>{{name}}</h2>
    <h2>{{counter}}</h2>

    <button @click="homeIncrement">home+1</button>
  </div>
</template>

<script>
  import { inject } from 'vue';

  export default {
    setup() {
      const name = inject("name");
      const counter = inject("counter");

      const homeIncrement = () => counter.value++

      return {
        name,
        counter,
        homeIncrement
      }
    }
  }
</script>
```





## ç¤ºä¾‹

### useCounter.js

```js
import { ref, computed } from 'vue';

export default function() {
  const counter = ref(0);
  const doubleCounter = computed(() => counter.value * 2);

  const increment = () => counter.value++;
  const decrement = () => counter.value--;

  return {
    counter, 
    doubleCounter, 
    increment, 
    decrement
  }
}
```



### useTitle.js

```js
import { ref, watch } from 'vue';

export default function(title = "é»˜è®¤çš„title") {
  const titleRef = ref(title);

  watch(titleRef, (newValue) => {
    document.title = newValue
  }, {
    immediate: true
  })

  return titleRef
}
```



### useScrollPosition.js

```js
import { ref } from 'vue';

export default function() {
  const scrollX = ref(0);
  const scrollY = ref(0);

  document.addEventListener("scroll", () => {
    scrollX.value = window.scrollX;
    scrollY.value = window.scrollY;
  });

  return {
    scrollX,
    scrollY
  }
}
```



### useMousePosition.js

```js
import { ref } from 'vue';

export default function() {
  const mouseX = ref(0);
  const mouseY = ref(0);

  window.addEventListener("mousemove", (event) => {
    mouseX.value = event.pageX;
    mouseY.value = event.pageY;
  });

  return {
    mouseX,
    mouseY
  }
}
```



### useLocalStorage.js

æˆ‘ä»¬æ¥å®Œæˆä¸€ä¸ªä½¿ç”¨ localStorage å­˜å‚¨å’Œè·å–æ•°æ®çš„Hook

```js
import { ref, watch } from 'vue';

export default function(key, value) {
  const data = ref(value);

  if (value) {
    window.localStorage.setItem(key, JSON.stringify(value));
  } else {
    data.value = JSON.parse(window.localStorage.getItem(key));
  }

  watch(data, (newValue) => {
    window.localStorage.setItem(key, JSON.stringify(newValue));
  })

  return data;
}

// ä¸€ä¸ªå‚æ•°: å–å€¼
// const data = useLocalStorage("name");

// äºŒä¸ªå‚æ•°: ä¿å­˜å€¼
// const data = useLocalStorage("name", "coderwhy");

// è‡ªåŠ¨ä¿®æ”¹å€¼
// data.value = "kobe";
```



### index.js

```js
import useCounter from './useCounter';
import useTitle from './useTitle';
import useScrollPosition from './useScrollPosition';
import useMousePosition from './useMousePosition';
import useLocalStorage from './useLocalStorage';

export {
  useCounter,
  useTitle,
  useScrollPosition,
  useMousePosition,
  useLocalStorage
}
```





## setup script ğŸ”¥

`<script setup>` æ˜¯åœ¨å•æ–‡ä»¶ç»„ä»¶ (SFC) ä¸­ä½¿ç”¨ç»„åˆå¼ API çš„ç¼–è¯‘æ—¶è¯­æ³•ç³–ã€‚ç›¸æ¯”äºæ™®é€šçš„` <script>` è¯­æ³•ï¼Œå®ƒå…·æœ‰æ›´å¤šä¼˜åŠ¿ï¼š

* æ›´å°‘çš„æ ·æ¿å†…å®¹ï¼Œæ›´ç®€æ´çš„ä»£ç ã€‚
* èƒ½å¤Ÿä½¿ç”¨**çº¯ Typescript å£°æ˜ props å’ŒæŠ›å‡ºäº‹ä»¶**ã€‚
* æ›´å¥½çš„è¿è¡Œæ—¶æ€§èƒ½ (å…¶æ¨¡æ¿ä¼šè¢«ç¼–è¯‘æˆä¸å…¶åŒä¸€ä½œç”¨åŸŸçš„æ¸²æŸ“å‡½æ•°ï¼Œæ²¡æœ‰ä»»ä½•çš„ä¸­é—´ä»£ç†)ã€‚
* æ›´å¥½çš„ IDE ç±»å‹æ¨æ–­æ€§èƒ½ (å‡å°‘è¯­è¨€æœåŠ¡å™¨ä»ä»£ç ä¸­æŠ½ç¦»ç±»å‹çš„å·¥ä½œ)ã€‚

App.vue

```vue
<template>
  <div>
    <h2>å½“å‰è®¡æ•°: {{ counter }}</h2>
    <button @click="increment">+1</button>

    <hello-world message="å‘µå‘µå‘µ" @increment="getCounter"></hello-world>
  </div>
</template>

<script setup>
import { ref } from 'vue'
import HelloWorld from './HelloWorld.vue'

const counter = ref(0)
const increment = () => counter.value++

const getCounter = (payload) => {
  console.log(payload)
}
</script>
```

HelloWorld.vue

```vue
<template>
  <div>
    <h2>Hello World</h2>
    <h2>{{ message }}</h2>
    <button @click="emitEvent">å‘å°„äº‹ä»¶</button>
  </div>
</template>

<script setup>
import { defineProps, defineEmits } from 'vue'

const props = defineProps({
  message: {
    type: String,
    default: 'å“ˆå“ˆå“ˆ',
  },
})

const emit = defineEmits(['increment', 'decrement'])

const emitEvent = () => {
  emit('increment', '100000')
}
</script>
```





